<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
<comment>Sentencias de actualización de datos de indicadores MO.DE.LO.</comment>
<entry key="foo">bar</entry>
<entry key="eiel_indicadores_i_cleandata">
DELETE FROM eiel_indicadores_d_accesibilidad where id_municipio='?M';
DELETE FROM eiel_indicadores_d_alumbrado where id_municipio='?M';
DELETE FROM eiel_indicadores_d_captaciones where id_municipio='?M';
DELETE FROM eiel_indicadores_d_casistencial where id_municipio='?M';
DELETE FROM eiel_indicadores_d_ccultura where id_municipio='?M';
DELETE FROM eiel_indicadores_d_centrosen where id_municipio='?M';
DELETE FROM eiel_indicadores_d_comunicaciones where id_municipio='?M';
DELETE FROM eiel_indicadores_d_csanitario where id_municipio='?M';
DELETE FROM eiel_indicadores_d_depositos where id_municipio='?M';
DELETE FROM eiel_indicadores_d_ideporte where id_municipio='?M';
DELETE FROM eiel_indicadores_d_pavimentacion where id_municipio='?M';
DELETE FROM eiel_indicadores_d_planeam where id_municipio='?M';
DELETE FROM eiel_indicadores_d_poblacion where id_municipio='?M';
DELETE FROM eiel_indicadores_d_potabilizacion where id_municipio='?M';
DELETE FROM eiel_indicadores_d_rblimpieza where id_municipio='?M';
DELETE FROM eiel_indicadores_d_rdistribucion where id_municipio='?M';
DELETE FROM eiel_indicadores_d_rsaneam where id_municipio='?M';
DELETE FROM eiel_indicadores_d_servotros where id_municipio='?M';
DELETE FROM eiel_indicadores_d_suministros where id_municipio='?M';
DELETE FROM eiel_indicadores_d_tratamresiduos where id_municipio='?M';
DELETE FROM eiel_indicadores_d_vertidos where id_municipio='?M';
DELETE FROM eiel_indicadores_d_viviendas where id_municipio='?M';
DELETE FROM eiel_indicadores_d_zverde where id_municipio='?M';


DELETE FROM eiel_indicadores_t_captaciones_aux where id_municipio='?M';

DELETE FROM eiel_indicadores_t_rdistribucion_aux where id_municipio='?M';
DELETE FROM  eiel_indicadores_d_rsaneam_aux where id_municipio='?M';

DELETE FROM eiel_indicadores_d_comunicaciones_aux where id_municipio='?M';
delete  from eiel_indicadores_t_rblimpieza_aux where id_municipio='?M';


</entry>
<!-- Indicadores de Poblacion a nivel de municipio -->
<entry key="eiel_indicadores_i_poblacion_mun">

INSERT INTO  eiel_indicadores_d_poblacion(
            "GEOMETRY", id_municipio, toponimo
            ,codprov, codmunic, codentidad, codpoblamiento
            ,numnucleos
            ,poblaciontotal 
            ,poblacionderecho
            ,poblaciondiseminado 
            ,poblacionestacional 
            ,poblaciondensidad 
            ,superficiemunicipal
            ,superficieurbana
            ,superficeresidencial 
            ,superficieagricolaforestalporcent
            )
SELECT 
       m."GEOMETRY",
        m.id as idmunicipio,m.nombreoficial,m.id_provincia, m.id_ine, null, null
        
       ,(SELECT COUNT(t.codmunic) FROM  eiel_t_nucl_encuest_1 t WHERE t.codprov=m.id_provincia and t.codmunic=m.id_ine and t.revision_expirada=9999999999) as numNucleosMunicipio
       ,((SELECT SUM(t.padron) FROM  eiel_t_nucl_encuest_1  t WHERE t.codprov=m.id_provincia and t.codmunic=m.id_ine and t.revision_expirada=9999999999) +
        (SELECT SUM(d.padron_dis) FROM  eiel_t_mun_diseminados d WHERE d.codprov=m.id_provincia and d.codmunic=m.id_ine and d.revision_expirada=9999999999))  as poblacionTOTAL
       ,(SELECT SUM(t.padron) FROM  eiel_t_nucl_encuest_1  t WHERE t.codprov=m.id_provincia and t.codmunic=m.id_ine and t.revision_expirada=9999999999) as poblacionDerecho
       ,(SELECT SUM(d.padron_dis) FROM  eiel_t_mun_diseminados d WHERE d.codprov=m.id_provincia and d.codmunic=m.id_ine and d.revision_expirada=9999999999 ) as poblacionDiseminadoNucleos
       ,(SELECT SUM(t.pob_estacional) FROM  eiel_t_nucl_encuest_1  t WHERE t.codprov=m.id_provincia and t.codmunic=m.id_ine and t.revision_expirada=9999999999) as poblacionEstacionalMax 
       ,((SELECT SUM(t.padron) FROM  eiel_t_nucl_encuest_1  t WHERE t.codprov=m.id_provincia and t.codmunic=m.id_ine and t.revision_expirada=9999999999) +
        (SELECT SUM(d.padron_dis) FROM  eiel_t_mun_diseminados d WHERE d.codprov=m.id_provincia and d.codmunic=m.id_ine and d.revision_expirada=9999999999)) 
        / (ST_Area(transform(m."GEOMETRY",23030))/1000000) as densidadPoblacion
       ,ST_Area(transform(m."GEOMETRY",23030))/1000000 as superficieMunicipal
       ,null as sueloUrbanoMunicipal
       ,null
       ,null

FROM  municipios m
WHERE m.id=?M and srid(m."GEOMETRY")=4230

GROUP BY 1,2,3,4,5,6,7
ORDER BY 2,3,4,5,6 ;
</entry>
<!-- Indicadores de Poblacion a nivel de núcleo -->
<entry key="eiel_indicadores_i_poblacion_nuc">
INSERT INTO  eiel_indicadores_d_poblacion(
            "GEOMETRY",id_municipio, toponimo
            ,codprov, codmunic, codentidad, codpoblamiento
            ,numnucleos
            ,poblaciontotal 
            ,poblacionderecho
            ,poblaciondiseminado 
            ,poblacionestacional 
            ,poblaciondensidad 
            ,superficiemunicipal
            ,superficieurbana
            ,superficeresidencial 
            ,superficieagricolaforestalporcent
            )

SELECT 
       n."GEOMETRY" as "GEOMETRY", (nE.codprov || nE.codmunic) as id_municipio, n.nombre_oficial
       ,ne.codprov, ne.codmunic,  ne.codentidad, ne.codpoblamiento
       ,COUNT(*)   as numNucleosMunicipio
       ,(ne.padron)  as poblacionTOTAL
       ,(ne.padron)      as poblacionDerechoNucleos
       ,0  as poblacionDiseminadoNucleos
       ,(ne.pob_estacional) as poblacionEstacionalMax   
       ,(ne.padron) /(ST_Area(transform(n."GEOMETRY",23030))/1000000)      as densidadPoblacion
       ,ST_Area(transform(n."GEOMETRY",23030))/1000000       as superficieMunicipal   
       ,0       as sueloUrbanoMunicipal
       ,0
       ,0

FROM 
     eiel_c_nucleo_poblacion n JOIN 
     eiel_t_nucl_encuest_1 ne  ON ( n.codprov=ne.codprov and n.codmunic=ne.codmunic and n.codentidad=ne.codentidad and n.codpoblamiento=ne.codpoblamiento and ne.revision_expirada=9999999999) 

WHERE n.codprov='?p' and n.codmunic='?m' --and (n.revision_expirada=9999999999)
GROUP BY 1,2,3,4,5,6,7,9,10,11,12
ORDER BY 2,3,4,5,6
</entry>
<entry key="eiel_indicadores_i_vivienda_mun">
INSERT INTO eiel_indicadores_d_viviendas(
            "GEOMETRY",id_municipio, toponimo
            ,codprov, codmunic, codentidad, codpoblamiento
            ,nviviendastotal, nviviendasnucleos,nviviendasdiseminado)


SELECT  m."GEOMETRY" as "GEOMETRY",
       m.id as id_municipio, m.nombreoficial
       ,m.id_provincia, m.id_ine,  null as codentidad , null as codpoblamiento
       ,(SELECT SUM(t.viviendas_total) FROM eiel_t_nucl_encuest_1 t WHERE t.codprov=m.id_provincia and t.codmunic=m.id_Ine ) + 
        (SELECT SUM(viv_total) FROM eiel_t_mun_diseminados nd WHERE nd.codprov=m.id_provincia and nd.codmunic=m.id_Ine )  as nviviendastotal
       ,(SELECT SUM(t.viviendas_total) FROM eiel_t_nucl_encuest_1 t WHERE t.codprov=m.id_provincia and t.codmunic=m.id_Ine )   as viviendasNucleos
       ,(SELECT SUM(viv_total) FROM eiel_t_mun_diseminados t WHERE t.codprov=m.id_provincia and t.codmunic=m.id_ine ) as viviendasDiseminado


FROM 
     --eiel_c_nucleo_poblacion n 
     --LEFT JOIN 
     municipios m 

WHERE m.id_provincia=?p and m.id_ine=?m and srid(m."GEOMETRY")=4230

GROUP BY  1,2,3,4,5,6
ORDER BY  2,3,4,5,6 ;
</entry>
<entry key="eiel_indicadores_i_vivienda_nuc">
INSERT INTO eiel_indicadores_d_viviendas(
            "GEOMETRY",id_municipio, toponimo
            ,codprov, codmunic, codentidad, codpoblamiento
            ,nviviendastotal, nviviendasnucleos,nviviendasdiseminado)

SELECT 
       n."GEOMETRY" as "GEOMETRY",(nE.codprov || nE.codmunic) as id_municipio, n.nombre_oficial
       ,ne.codprov, ne.codmunic, ne.codentidad, ne.codpoblamiento
       ,(ne.viviendas_total) as nviviendastotal
       ,(ne.viviendas_total)   as viviendasNucleos
       ,0 as viviendasDiseminado

FROM 
     eiel_c_nucleo_poblacion n 
     JOIN 
     eiel_t_nucl_encuest_1 ne ON ( n.codprov=ne.codprov and n.codmunic=ne.codmunic and n.codentidad=ne.codentidad and n.codpoblamiento=ne.codpoblamiento) 

WHERE n.codprov='?p' and n.codmunic='?m' 
      --and (n.revision_expirada=9999999999)
GROUP BY 1,2,3,4,5,6,7,8,9
ORDER BY 2,3,4,5,6;
</entry>
<entry key="eiel_indicadores_i_planeamiento_mun">
INSERT INTO eiel_indicadores_d_planeam(
             "GEOMETRY", id_municipio,toponimo, codprov, codmunic, codentidad,codpoblamiento, 
            fplan_supramunicipal, fplan_pgom, normassubsidiariasprov, 
            sup_municipal,sup_urbana, sup_urbanizable, sup_nourbanizable)

SELECT 
       null as "GEOMETRY"
       ,m.id as id_municipio, null as toponimo
       ,substr(m.id,1,2) as codprov, substr(m.id,3,5) as codmunic,  null as codentidad , null as codpoblamiento
       ,null
       ,(SELECT fecha_bo FROM eiel_t_planeam_urban WHERE eiel_t_planeam_urban.codmunic=substr(m.id,3,5) and tipo_urba='P.G' ORDER BY 1 DESC LIMIT 1) as fplan_pgom
       ,(SELECT fecha_bo FROM eiel_t_planeam_urban WHERE eiel_t_planeam_urban.codmunic=substr(m.id,3,5) and tipo_urba='N.M' ORDER BY 1 DESC LIMIT 1) as fnormassubsidiariasprov  
      ,(SELECT sup_muni FROM eiel_t_planeam_urban WHERE eiel_t_planeam_urban.codmunic=substr(m.id,3,5) and tipo_urba='P.G' ORDER BY 1 DESC LIMIT 1)       as superficieMunicipal   
      ,(SELECT s_urbano FROM eiel_t_planeam_urban WHERE eiel_t_planeam_urban.codmunic=substr(m.id,3,5) and tipo_urba='P.G' ORDER BY 1 DESC LIMIT 1)        as sup_urbana
       ,(SELECT s_urbanizable FROM eiel_t_planeam_urban WHERE eiel_t_planeam_urban.codmunic=substr(m.id,3,5) and tipo_urba='P.G' ORDER BY 1 DESC LIMIT 1)   as sup_urbanizable
       ,(SELECT s_no_urbanizable FROM eiel_t_planeam_urban WHERE eiel_t_planeam_urban.codmunic=substr(m.id,3,5) and tipo_urba='P.G' ORDER BY 1 DESC LIMIT 1)   as sup_nourbanizable

FROM 
     --eiel_c_nucleo_poblacion n 
     --LEFT JOIN 
     municipios m --ON ( n.codprov=ne.codprov and n.codmunic=ne.codmunic) 
     
     LEFT JOIN eiel_t_planeam_urban pu  ON ( substr(m.id,1,2)=pu.codprov and 
                                             substr(m.id,3,5)=pu.codmunic and 
                                             pu.fecha_bo=(SELECT fecha_bo FROM eiel_t_planeam_urban WHERE eiel_t_planeam_urban.codmunic=substr(m.id,2,5) ORDER BY 1 DESC LIMIT 1 )
                                           )
WHERE m.id='?M'
ORDER BY 1,3,4,5,6 ;
</entry>
<entry key="eiel_indicadores_i_planeamiento_nuc"></entry>
<entry key="eiel_indicadores_ii_captaciones_pre">
INSERT INTO eiel_indicadores_t_captaciones_aux(
            "GEOMETRY", id_municipio, nombre_oficial, codprov, codmunic, 
            codentidad, codpoblamiento, aag_caudal, aag_restri, habitantes, 
            pobestacional)

SELECT 
       n."GEOMETRY", id_municipio, n.nombre_oficial
       ,ne.codprov, ne.codmunic, ne.codentidad, ne.codpoblamiento
       ,ne2.aag_caudal
       ,ne2.aag_restri
       ,SUM(ne.padron) as habitantes
       ,SUM(ne.pob_estacional) as pobEstacional



FROM 
     eiel_c_nucleo_poblacion n 
      ,
     eiel_t_nucl_encuest_1 ne        
      , eiel_t_nucl_encuest_2 ne2 


WHERE n.codprov='?p' and n.codmunic='?m' and 
       --(n.revision_expirada=9999999999) and
       (ne.revision_expirada=9999999999) and
       ( n.codprov=ne.codprov and n.codmunic=ne.codmunic and n.codentidad=ne.codentidad and n.codpoblamiento=ne.codpoblamiento) and 
       (n.codprov=ne2.codprov and n.codmunic=ne2.codmunic and n.codentidad=ne2.codentidad and n.codpoblamiento=ne2.codpoblamiento) 

GROUP BY 1,2,3,4,5,6,7,8,9
ORDER BY 2,4,5,6,7;
</entry>

<entry key="eiel_indicadores_ii_captaciones_mun">

INSERT INTO eiel_indicadores_d_captaciones(
            "GEOMETRY", id_municipio, toponimo,
            codprov, codmunic, codentidad, codpoblamiento, 
            numn_caudalsuf, numn_caudalins, 
            numhab_cauldalsuf, numhab_caudalins, 
            numest_caudalsuf, numest_caudalins, 
            
            numn_restricf, numn_restricm, numn_restricn, 
            numhab_restricf, numhab_restricm, numhab_resticn, 
            numest_restricf, numest_restricm, numest_restricn 
            
            ,ncaptaciones, ncaptacionesb, ncaptacionesr, ncaptacionesm
)

SELECT DISTINCT
       m."GEOMETRY",
        (n.codprov||n.codmunic) as idmunicipio,m.nombreoficial
         ,n.codprov, n.codmunic, null, null
       ,(SELECT COUNT(codpoblamiento) from eiel_indicadores_t_captaciones_aux t WHERE aag_caudal='SF' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nucleosCaudalSuficiente
       ,(SELECT COUNT(codpoblamiento) from eiel_indicadores_t_captaciones_aux t WHERE aag_caudal IN ('IN','NO') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nucleosCaudalInuficiente
       ,(SELECT SUM(habitantes) from eiel_indicadores_t_captaciones_aux t WHERE aag_caudal='SF' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as habitantesCaudalSuficiente
       ,(SELECT SUM(habitantes) from eiel_indicadores_t_captaciones_aux t WHERE aag_caudal IN ('IN','NO') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as habitantesCaudalInsuficiente
       ,(SELECT SUM(pobEstacional) from eiel_indicadores_t_captaciones_aux t WHERE aag_caudal='SF' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as pobEstCaudalSuficiente
       ,(SELECT SUM(pobEstacional) from eiel_indicadores_t_captaciones_aux t WHERE aag_caudal IN ('IN','NO') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as pobEstCaudalInsuficiente

       ,(SELECT COUNT(codpoblamiento) from eiel_indicadores_t_captaciones_aux t WHERE aag_restri='RF' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nucleosRestriccionesFuertes
       ,(SELECT COUNT(codpoblamiento) from eiel_indicadores_t_captaciones_aux t WHERE aag_restri='RM' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nucleosRestriccionesMedias
       ,(SELECT COUNT(codpoblamiento) from eiel_indicadores_t_captaciones_aux t WHERE aag_restri='NO' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nucleosRestriccionesNO         

       ,(SELECT SUM(habitantes) from eiel_indicadores_t_captaciones_aux t WHERE aag_restri='RF' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as habitantesRestriccionesFuertes
       ,(SELECT SUM(habitantes) from eiel_indicadores_t_captaciones_aux t WHERE aag_restri='RM' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as habitantesRestriccionesMedias
       ,(SELECT SUM(habitantes) from eiel_indicadores_t_captaciones_aux t WHERE aag_restri='NO' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as habitantesRestriccionesNO        

       ,(SELECT SUM(pobestacional) from eiel_indicadores_t_captaciones_aux t WHERE aag_restri='RF' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as pobEstRestriccionesFuertes
       ,(SELECT SUM(pobestacional) from eiel_indicadores_t_captaciones_aux t WHERE aag_restri='RM' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as pobEstRestriccionesMedias
       ,(SELECT SUM(pobestacional) from eiel_indicadores_t_captaciones_aux t WHERE aag_restri='NO' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as pobEstRestriccionesNO                      

       ,(SELECT COUNT(*) from eiel_t_abast_ca t WHERE n.codprov=t.codprov and n.codmunic=t.codmunic )   as nCaptaciones
            
       ,(SELECT COUNT(*) from eiel_t_abast_ca t WHERE estado='B' and n.codprov=t.codprov and n.codmunic=t.codmunic )   as nCaptacionesB          
       ,(SELECT COUNT(*) from eiel_t_abast_ca t WHERE estado='R'  and n.codprov=t.codprov and n.codmunic=t.codmunic )   as nCaptacionesR     
       ,(SELECT COUNT(*) from eiel_t_abast_ca t WHERE estado='M' and n.codprov=t.codprov and n.codmunic=t.codmunic )   as nCaptacionesB     
    
FROM  municipios m, eiel_c_nucleo_poblacion n 
WHERE m.id=?M and n.codprov=m.id_provincia and n.codmunic=m.id_ine and srid(m."GEOMETRY")=4230
      --and (n.revision_expirada=9999999999) 
GROUP BY 1,2,3,4,5
ORDER by 2,3,4,5,6;

</entry>

<entry key="eiel_indicadores_ii_captaciones_nuc">
INSERT INTO eiel_indicadores_d_captaciones(
            "GEOMETRY",id_municipio,toponimo , codprov, codmunic, codentidad, codpoblamiento, 
            numn_caudalsuf, numn_caudalins, 
            numhab_cauldalsuf, numhab_caudalins, 
            numest_caudalsuf, numest_caudalins, 
            
            numn_restricf, numn_restricm, numn_restricn, 
            numhab_restricf, numhab_restricm, numhab_resticn, 
            numest_restricf, numest_restricm, numest_restricn, 
            
            ncaptaciones, ncaptacionesb, ncaptacionesr, ncaptacionesm)

SELECT
        n."GEOMETRY", (n.codprov||n.codmunic) as idmunicipio,n.nombre_oficial,
         n.codprov, n.codmunic, n.codentidad, n.codpoblamiento
       ,(SELECT COUNT(codpoblamiento) from eiel_indicadores_t_captaciones_aux t WHERE aag_caudal='SF' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nucleosCaudalSuficiente
       ,(SELECT COUNT(codpoblamiento) from eiel_indicadores_t_captaciones_aux t WHERE aag_caudal IN ('IN','NO') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nucleosCaudalInuficiente
       ,(SELECT SUM(habitantes) from eiel_indicadores_t_captaciones_aux t WHERE aag_caudal='SF' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as habitantesCaudalSuficiente
       ,(SELECT SUM(habitantes) from eiel_indicadores_t_captaciones_aux t WHERE aag_caudal IN ('IN','NO') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as habitantesCaudalInsuficiente
       ,(SELECT SUM(pobEstacional) from eiel_indicadores_t_captaciones_aux t WHERE aag_caudal='SF' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as pobEstCaudalSuficiente
       ,(SELECT SUM(pobEstacional) from eiel_indicadores_t_captaciones_aux t WHERE aag_caudal IN ('IN','NO') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as pobEstCaudalInsuficiente

       ,(SELECT COUNT(codpoblamiento) from eiel_indicadores_t_captaciones_aux t WHERE aag_restri='RF' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nucleosRestriccionesFuertes
       ,(SELECT COUNT(codpoblamiento) from eiel_indicadores_t_captaciones_aux t WHERE aag_restri='RM' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nucleosRestriccionesMedias
       ,(SELECT COUNT(codpoblamiento) from eiel_indicadores_t_captaciones_aux t WHERE aag_restri='NO' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nucleosRestriccionesNO         

       ,(SELECT SUM(habitantes) from eiel_indicadores_t_captaciones_aux t WHERE aag_restri='RF' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as habitantesRestriccionesFuertes
       ,(SELECT SUM(habitantes) from eiel_indicadores_t_captaciones_aux t WHERE aag_restri='RM' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as habitantesRestriccionesMedias
       ,(SELECT SUM(habitantes) from eiel_indicadores_t_captaciones_aux t WHERE aag_restri='NO' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as habitantesRestriccionesNO        

       ,(SELECT SUM(pobestacional) from eiel_indicadores_t_captaciones_aux t WHERE aag_restri='RF' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as pobEstRestriccionesFuertes
       ,(SELECT SUM(pobestacional) from eiel_indicadores_t_captaciones_aux t WHERE aag_restri='RM' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as pobEstRestriccionesMedias
       ,(SELECT SUM(pobestacional) from eiel_indicadores_t_captaciones_aux t WHERE aag_restri='NO' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as pobEstRestriccionesNO                      
       
       ,(SELECT COUNT(*) FROM eiel_t_abast_ca t, eiel_tr_abast_ca_pobl ca WHERE t.clave=ca.clave_ca and t.codprov=ca.codprov_ca and t.codmunic=ca.codmunic_ca and t.orden_ca=ca.orden_ca and n.codprov=ca.codprov_pobl and n.codmunic=ca.codmunic_pobl and n.codentidad=ca.codentidad_pobl and n.codpoblamiento=ca.codpoblamiento_pobl and t.revision_expirada=9999999999 and ca.revision_expirada=9999999999) as nCaptaciones
       ,(SELECT COUNT(*) FROM eiel_t_abast_ca t, eiel_tr_abast_ca_pobl ca WHERE t.clave=ca.clave_ca and t.codprov=ca.codprov_ca and t.codmunic=ca.codmunic_ca and t.orden_ca=ca.orden_ca and n.codprov=ca.codprov_pobl and n.codmunic=ca.codmunic_pobl and n.codentidad=ca.codentidad_pobl and n.codpoblamiento=ca.codpoblamiento_pobl and t.estado='B' and t.revision_expirada=9999999999 and ca.revision_expirada=9999999999)  as nCaptacionesB     
       ,(SELECT COUNT(*) FROM eiel_t_abast_ca t, eiel_tr_abast_ca_pobl ca WHERE t.clave=ca.clave_ca and t.codprov=ca.codprov_ca and t.codmunic=ca.codmunic_ca and t.orden_ca=ca.orden_ca and n.codprov=ca.codprov_pobl and n.codmunic=ca.codmunic_pobl and n.codentidad=ca.codentidad_pobl and n.codpoblamiento=ca.codpoblamiento_pobl and t.estado='R' and t.revision_expirada=9999999999 and ca.revision_expirada=9999999999)  as nCaptacionesR
       ,(SELECT COUNT(*) FROM eiel_t_abast_ca t, eiel_tr_abast_ca_pobl ca WHERE t.clave=ca.clave_ca and t.codprov=ca.codprov_ca and t.codmunic=ca.codmunic_ca and t.orden_ca=ca.orden_ca and n.codprov=ca.codprov_pobl and n.codmunic=ca.codmunic_pobl and n.codentidad=ca.codentidad_pobl and n.codpoblamiento=ca.codpoblamiento_pobl and t.estado='M' and t.revision_expirada=9999999999 and ca.revision_expirada=9999999999)  as nCaptacionesM   

FROM  eiel_c_nucleo_poblacion n 
WHERE n.codprov='?p' and n.codmunic='?m' 
      --and (n.revision_expirada=9999999999)
ORDER by 2,3,4,5,6,7;
</entry>


<entry key="eiel_indicadores_ii_depositos_mun">
INSERT INTO eiel_indicadores_d_depositos(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, codpoblamiento,
            capacidadtotal, capacidad_b, capacidad_r, capacidad_m, 
            ndepositosTotal, ndepositos_b, ndepositos_r, ndepositos_m)


SELECT 
        m."GEOMETRY", (n.codprov||n.codmunic) as id_municipio,m.nombreoficial,
        n.codprov as codprov, n.codmunic as codmunic, null as codentidad, null as codpoblamiento

       ,(SELECT SUM(tde.capacidad) FROM  eiel_c_abast_de de 
                               LEFT JOIN eiel_t_abast_de tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_de = tde.orden_de) 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",m."GEOMETRY") ) as capacidadTotal


       ,(SELECT SUM(tde.capacidad) FROM  eiel_c_abast_de de 
                                JOIN eiel_t_abast_de tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_de = tde.orden_de and tde.estado='B') 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",m."GEOMETRY") ) as capacidadEstadoB
       ,(SELECT SUM(tde.capacidad) FROM  eiel_c_abast_de de 
                                JOIN eiel_t_abast_de tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_de = tde.orden_de and tde.estado='R') 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",m."GEOMETRY") ) as capacidadEstadoR
       ,(SELECT SUM(tde.capacidad) FROM  eiel_c_abast_de de 
                                JOIN eiel_t_abast_de tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_de = tde.orden_de and tde.estado='M') 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",m."GEOMETRY") ) as capacidadEstadoM
                                        
       ,(SELECT COUNT(*) FROM  eiel_c_abast_de de 
                               LEFT JOIN eiel_t_abast_de tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_de = tde.orden_de) 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",m."GEOMETRY") ) as numDepositosNucleo

       ,(SELECT COUNT(*) FROM  eiel_c_abast_de de 
                                JOIN eiel_t_abast_de tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_de = tde.orden_de and tde.estado='B') 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",m."GEOMETRY") ) as nmun_depositos_b
       ,(SELECT COUNT(*) FROM  eiel_c_abast_de de 
                                JOIN eiel_t_abast_de tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_de = tde.orden_de and tde.estado='R') 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",m."GEOMETRY") ) as nmun_depositos_r
       ,(SELECT COUNT(*) FROM  eiel_c_abast_de de 
                               JOIN eiel_t_abast_de tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_de = tde.orden_de and tde.estado='M') 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",m."GEOMETRY") ) as nmun_depositos_m    




FROM  municipios m, eiel_c_nucleo_poblacion n 
WHERE m.id=?M and and n.codprov=m.id_provincia and n.codmunic=m.id_ine and (n.revision_expirada=9999999999) and srid(m."GEOMETRY")=4230 
group by 1,2,3,4,5,6,7
ORDER by 2,4,5,6,7;
</entry>

<entry key="eiel_indicadores_ii_depositos_nuc">
INSERT INTO eiel_indicadores_d_depositos(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, codpoblamiento,
            capacidadtotal, capacidad_b, capacidad_r, capacidad_m, 
            ndepositosTotal, ndepositos_b, ndepositos_r, ndepositos_m)


SELECT 
        n."GEOMETRY", (n.codprov||n.codmunic) as idmunicipio,n.nombre_oficial,
         n.codprov, n.codmunic, n.codentidad, n.codpoblamiento


       ,(SELECT SUM(tde.capacidad) FROM  eiel_tr_abast_de_pobl de 
                               LEFT JOIN eiel_t_abast_de tde ON (de.codprov_pobl = tde.codprov AND de.codmunic_pobl = tde.codmunic AND de.clave_de = tde.clave  AND  de.orden_de = tde.orden_de) 
                               WHERE n.codprov=de.codprov_pobl and n.codmunic=de.codmunic_pobl AND n.codentidad=de.codentidad_pobl AND n.codpoblamiento=de.codpoblamiento_pobl ) as capacidadTotal
       ,(SELECT SUM(tde.capacidad) FROM  eiel_tr_abast_de_pobl de 
                               LEFT JOIN eiel_t_abast_de tde ON (de.codprov_pobl = tde.codprov AND de.codmunic_pobl = tde.codmunic AND de.clave_de = tde.clave  AND  de.orden_de = tde.orden_de and tde.estado='B') 
                               WHERE n.codprov=de.codprov_pobl and n.codmunic=de.codmunic_pobl AND n.codentidad=de.codentidad_pobl AND n.codpoblamiento=de.codpoblamiento_pobl ) as capacidadTotal_B  
       ,(SELECT SUM(tde.capacidad) FROM  eiel_tr_abast_de_pobl de 
                               LEFT JOIN eiel_t_abast_de tde ON (de.codprov_pobl = tde.codprov AND de.codmunic_pobl = tde.codmunic AND de.clave_de = tde.clave  AND  de.orden_de = tde.orden_de and tde.estado='R') 
                               WHERE n.codprov=de.codprov_pobl and n.codmunic=de.codmunic_pobl AND n.codentidad=de.codentidad_pobl AND n.codpoblamiento=de.codpoblamiento_pobl ) as capacidadTotal_R        
       ,(SELECT SUM(tde.capacidad) FROM  eiel_tr_abast_de_pobl de 
                               LEFT JOIN eiel_t_abast_de tde ON (de.codprov_pobl = tde.codprov AND de.codmunic_pobl = tde.codmunic AND de.clave_de = tde.clave  AND  de.orden_de = tde.orden_de and tde.estado='M') 
                               WHERE n.codprov=de.codprov_pobl and n.codmunic=de.codmunic_pobl AND n.codentidad=de.codentidad_pobl AND n.codpoblamiento=de.codpoblamiento_pobl ) as capacidadTotal_M                                                      
       ,(SELECT COUNT(*) FROM  eiel_tr_abast_de_pobl de 
                               LEFT JOIN eiel_t_abast_de tde ON (de.codprov_pobl = tde.codprov AND de.codmunic_pobl = tde.codmunic AND de.clave_de = tde.clave  AND  de.orden_de = tde.orden_de) 
                               WHERE n.codprov=de.codprov_pobl and n.codmunic=de.codmunic_pobl AND n.codentidad=de.codentidad_pobl AND n.codpoblamiento=de.codpoblamiento_pobl ) as numDepositosNucleo         


       ,(SELECT COUNT(*) FROM  eiel_tr_abast_de_pobl de 
                                JOIN eiel_t_abast_de tde ON (de.codprov_pobl = tde.codprov AND de.codmunic_pobl = tde.codmunic AND de.clave_de = tde.clave  AND  de.orden_de = tde.orden_de and tde.estado='B') 
                               WHERE n.codprov=de.codprov_pobl and n.codmunic=de.codmunic_pobl AND n.codentidad=de.codentidad_pobl AND n.codpoblamiento=de.codpoblamiento_pobl ) as nmun_depositos_b
       ,(SELECT COUNT(*) FROM  eiel_tr_abast_de_pobl de 
                                JOIN eiel_t_abast_de tde ON (de.codprov_pobl = tde.codprov AND de.codmunic_pobl = tde.codmunic AND de.clave_de = tde.clave  AND  de.orden_de = tde.orden_de and tde.estado='R') 
                               WHERE n.codprov=de.codprov_pobl and n.codmunic=de.codmunic_pobl AND n.codentidad=de.codentidad_pobl AND n.codpoblamiento=de.codpoblamiento_pobl ) as nmun_depositos_r
       ,(SELECT COUNT(*) FROM  eiel_tr_abast_de_pobl de 
                                JOIN eiel_t_abast_de tde ON (de.codprov_pobl = tde.codprov AND de.codmunic_pobl = tde.codmunic AND de.clave_de = tde.clave  AND  de.orden_de = tde.orden_de and tde.estado='M') 
                               WHERE n.codprov=de.codprov_pobl and n.codmunic=de.codmunic_pobl AND n.codentidad=de.codentidad_pobl AND n.codpoblamiento=de.codpoblamiento_pobl ) as nmun_depositos_m    




FROM  eiel_c_nucleo_poblacion n 
WHERE n.codprov='?p' and n.codmunic='?m' 
      --and (n.revision_expirada=9999999999)
group by 1,2,3,4,5,6,7
ORDER by 2,4,5,6,7;
</entry>
<entry key="eiel_indicadores_ii_potabilizadoras_mun">INSERT INTO eiel_indicadores_d_potabilizacion(
            "GEOMETRY",  id_municipio, toponimo,  codprov, codmunic, codentidad, codpoblamiento, 
            npotab, npotab_clorac, npotab_basica, npotab_otros, 
            npercontrol_a, npercontrol_m, npercontrol_b, npercontrol_n, 
            npotab_estadob, npotab_estador, npotab_estadom)

SELECT 
        m."GEOMETRY", (n.codprov||n.codmunic) as id_municipio,m.nombreoficial,
        n.codprov as codprov, n.codmunic as codmunic, null as codentidad, null as codpoblamiento
                                                      
         
       ,(SELECT COUNT(*) FROM  eiel_c_abast_tp de 
                                JOIN eiel_t_abast_tp tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_tp = tde.orden_tp) 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",m."GEOMETRY") ) as nPotabilizadorasNucleo

       ,(SELECT COUNT(*) FROM  eiel_c_abast_tp de 
                                JOIN eiel_t_abast_tp tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_tp = tde.orden_tp and tde.desinf_1 IN ('HP','CL')) 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",m."GEOMETRY") ) as nPotabilizadorasCloracion
       ,(SELECT COUNT(*) FROM  eiel_c_abast_tp de 
                                JOIN eiel_t_abast_tp tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_tp = tde.orden_tp and tde.desinf_1 IN ('NO')) 
                        
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",m."GEOMETRY") ) as nPotabilizadorasBasica
       , null as nPotabilizadorasOtros 
       ,(SELECT COUNT(*) FROM  eiel_c_abast_tp de 
                                JOIN eiel_t_abast_tp tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_tp = tde.orden_tp and tde.periodicidad IN ('AL','DI')) 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",m."GEOMETRY") ) as nPobatilizadorasCtrlCalidadAlto
       ,(SELECT COUNT(*) FROM  eiel_c_abast_tp de 
                                JOIN eiel_t_abast_tp tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_tp = tde.orden_tp and tde.periodicidad IN ('SE','QU')) 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",m."GEOMETRY") ) as nPobatilizadorasCtrlCalidadMedio
       ,(SELECT COUNT(*) FROM  eiel_c_abast_tp de 
                                JOIN eiel_t_abast_tp tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_tp = tde.orden_tp and tde.periodicidad IN ('ME')) 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",m."GEOMETRY") ) as nPobatilizadorasCtrlCalidadBajo
       ,(SELECT COUNT(*) FROM  eiel_c_abast_tp de 
                                JOIN eiel_t_abast_tp tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_tp = tde.orden_tp and tde.periodicidad IN ('NO')) 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",m."GEOMETRY") ) as nPobatilizadorasCtrlCalidadNO

       ,(SELECT COUNT(*) FROM  eiel_c_abast_tp de 
                                JOIN eiel_t_abast_tp tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_tp = tde.orden_tp and tde.estado='B') 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",m."GEOMETRY") ) as nPobatilizadorasEstadoB
       ,(SELECT COUNT(*) FROM  eiel_c_abast_tp de 
                                JOIN eiel_t_abast_tp tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_tp = tde.orden_tp and tde.estado='R') 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",m."GEOMETRY") ) as nPobatilizadorasEstadoR
       ,(SELECT COUNT(*) FROM  eiel_c_abast_tp de 
                                JOIN eiel_t_abast_tp tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_tp = tde.orden_tp and tde.estado='M') 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",m."GEOMETRY") ) as nPobatilizadorasEstadoM




FROM  municipios m, eiel_c_nucleo_poblacion n 
WHERE m.id=?M  and n.codprov=m.id_provincia and n.codmunic=m.id_ine and srid(m."GEOMETRY")=4230 
      -- and (n.revision_expirada=9999999999) 
group by 1,2,3,4,5,6,7
ORDER by 2,4,5,6,7;</entry>
<entry key="eiel_indicadores_ii_potabilizadoras_nuc">INSERT INTO eiel_indicadores_d_potabilizacion(
            "GEOMETRY",  id_municipio, toponimo,  codprov, codmunic, codentidad, codpoblamiento, 
            npotab, npotab_clorac, npotab_basica, npotab_otros, 
            npercontrol_a, npercontrol_m, npercontrol_b, npercontrol_n, 
            npotab_estadob, npotab_estador, npotab_estadom)



SELECT 
        n."GEOMETRY", (n.codprov||n.codmunic) as idmunicipio,n.nombre_oficial,
        n.codprov, n.codmunic, n.codentidad, n.codpoblamiento

                                                      
                                                      
         
       ,(SELECT COUNT(*) FROM  eiel_tr_abast_tp_pobl de 
                                LEFT JOIN eiel_t_abast_tp tde ON (de.codprov_pobl = tde.codprov AND de.codmunic_pobl = tde.codmunic AND de.clave_tp = tde.clave  AND  de.orden_tp = tde.orden_tp and de.revision_expirada=9999999999 and tde.revision_expirada=9999999999) 
                               WHERE n.codprov=de.codprov_pobl and n.codmunic=de.codmunic_pobl AND n.codentidad=de.codentidad_pobl AND n.codpoblamiento=de.codpoblamiento_pobl ) as nPotabilizadorasNucleo

       ,(SELECT COUNT(*) FROM  eiel_tr_abast_tp_pobl de 
                                 JOIN eiel_t_abast_tp tde ON (de.codprov_pobl = tde.codprov AND de.codmunic_pobl = tde.codmunic AND de.clave_tp = tde.clave  AND  de.orden_tp = tde.orden_tp and tde.desinf_1 IN ('HP','CL') and de.revision_expirada=9999999999 and tde.revision_expirada=9999999999) 
                               WHERE n.codprov=de.codprov_pobl and n.codmunic=de.codmunic_pobl AND n.codentidad=de.codentidad_pobl AND n.codpoblamiento=de.codpoblamiento_pobl ) as nPotabilizadorasCloracion                               

       ,(SELECT COUNT(*) FROM  eiel_tr_abast_tp_pobl de 
                                 JOIN eiel_t_abast_tp tde ON (de.codprov_pobl = tde.codprov AND de.codmunic_pobl = tde.codmunic AND de.clave_tp = tde.clave  AND  de.orden_tp = tde.orden_tp and tde.desinf_1 IN ('NO') and de.revision_expirada=9999999999 and tde.revision_expirada=9999999999) 
                               WHERE n.codprov=de.codprov_pobl and n.codmunic=de.codmunic_pobl AND n.codentidad=de.codentidad_pobl AND n.codpoblamiento=de.codpoblamiento_pobl ) as nPotabilizadorasBasica                               
                               
                               
       ,(SELECT COUNT(*) FROM  eiel_tr_abast_tp_pobl de 
                                 JOIN eiel_t_abast_tp tde ON (de.codprov_pobl = tde.codprov AND de.codmunic_pobl = tde.codmunic AND de.clave_tp = tde.clave  AND  de.orden_tp = tde.orden_tp and tde.desinf_1 NOT IN ('HP','CL','NO') and de.revision_expirada=9999999999 and tde.revision_expirada=9999999999) 
                               WHERE n.codprov=de.codprov_pobl and n.codmunic=de.codmunic_pobl AND n.codentidad=de.codentidad_pobl AND n.codpoblamiento=de.codpoblamiento_pobl ) as nPotabilizadorasOtros
                               
       ,(SELECT COUNT(*) FROM  eiel_tr_abast_tp_pobl de 
                                 JOIN eiel_t_abast_tp tde ON (de.codprov_pobl = tde.codprov AND de.codmunic_pobl = tde.codmunic AND de.clave_tp = tde.clave  AND  de.orden_tp = tde.orden_tp and tde.periodicidad IN ('AL','DI') and de.revision_expirada=9999999999 and tde.revision_expirada=9999999999) 
                               WHERE n.codprov=de.codprov_pobl and n.codmunic=de.codmunic_pobl AND n.codentidad=de.codentidad_pobl AND n.codpoblamiento=de.codpoblamiento_pobl ) as nPobatilizadorasCtrlCalidadAlto 
       ,(SELECT COUNT(*)  FROM  eiel_tr_abast_tp_pobl de 
                                 JOIN eiel_t_abast_tp tde ON (de.codprov_pobl = tde.codprov AND de.codmunic_pobl = tde.codmunic AND de.clave_tp = tde.clave  AND  de.orden_tp = tde.orden_tp and tde.periodicidad IN ('SE','QU') and de.revision_expirada=9999999999 and tde.revision_expirada=9999999999) 
                               WHERE n.codprov=de.codprov_pobl and n.codmunic=de.codmunic_pobl AND n.codentidad=de.codentidad_pobl AND n.codpoblamiento=de.codpoblamiento_pobl ) as nPobatilizadorasCtrlCalidadMedio 
       ,(SELECT COUNT(*)  FROM  eiel_tr_abast_tp_pobl de 
                                 JOIN eiel_t_abast_tp tde ON (de.codprov_pobl = tde.codprov AND de.codmunic_pobl = tde.codmunic AND de.clave_tp = tde.clave  AND  de.orden_tp = tde.orden_tp and tde.periodicidad IN ('ME') and de.revision_expirada=9999999999 and tde.revision_expirada=9999999999) 
                               WHERE n.codprov=de.codprov_pobl and n.codmunic=de.codmunic_pobl AND n.codentidad=de.codentidad_pobl AND n.codpoblamiento=de.codpoblamiento_pobl ) as nPobatilizadorasCtrlCalidadBajo 
       ,(SELECT COUNT(*) FROM  eiel_tr_abast_tp_pobl de 
                                 JOIN eiel_t_abast_tp tde ON (de.codprov_pobl = tde.codprov AND de.codmunic_pobl = tde.codmunic AND de.clave_tp = tde.clave  AND  de.orden_tp = tde.orden_tp and tde.periodicidad IN ('NO') and de.revision_expirada=9999999999 and tde.revision_expirada=9999999999) 
                               WHERE n.codprov=de.codprov_pobl and n.codmunic=de.codmunic_pobl AND n.codentidad=de.codentidad_pobl AND n.codpoblamiento=de.codpoblamiento_pobl ) as nPobatilizadorasCtrlCalidadNO 

       ,(SELECT COUNT(*) FROM  eiel_tr_abast_tp_pobl de 
                                 JOIN eiel_t_abast_tp tde ON (de.codprov_pobl = tde.codprov AND de.codmunic_pobl = tde.codmunic AND de.clave_tp = tde.clave  AND  de.orden_tp = tde.orden_tp and  tde.estado='B' and de.revision_expirada=9999999999 and tde.revision_expirada=9999999999) 
                               WHERE n.codprov=de.codprov_pobl and n.codmunic=de.codmunic_pobl AND n.codentidad=de.codentidad_pobl AND n.codpoblamiento=de.codpoblamiento_pobl ) as nPobatilizadorasEstadoB 
       ,(SELECT COUNT(*) FROM  eiel_tr_abast_tp_pobl de 
                                 JOIN eiel_t_abast_tp tde ON (de.codprov_pobl = tde.codprov AND de.codmunic_pobl = tde.codmunic AND de.clave_tp = tde.clave  AND  de.orden_tp = tde.orden_tp and  tde.estado='R' and de.revision_expirada=9999999999 and tde.revision_expirada=9999999999) 
                               WHERE n.codprov=de.codprov_pobl and n.codmunic=de.codmunic_pobl AND n.codentidad=de.codentidad_pobl AND n.codpoblamiento=de.codpoblamiento_pobl ) as nPobatilizadorasEstadoR
       ,(SELECT COUNT(*) FROM  eiel_tr_abast_tp_pobl de 
                                 JOIN eiel_t_abast_tp tde ON (de.codprov_pobl = tde.codprov AND de.codmunic_pobl = tde.codmunic AND de.clave_tp = tde.clave  AND  de.orden_tp = tde.orden_tp and  tde.estado='M' and de.revision_expirada=9999999999 and tde.revision_expirada=9999999999) 
                               WHERE n.codprov=de.codprov_pobl and n.codmunic=de.codmunic_pobl AND n.codentidad=de.codentidad_pobl AND n.codpoblamiento=de.codpoblamiento_pobl ) as nPobatilizadorasEstadoM




FROM  eiel_c_nucleo_poblacion n 
WHERE n.codprov='?p' and n.codmunic='?m' 
      --and n.revision_expirada=9999999999
group by 1,2,3,4,5,6,7
ORDER by 2,4,5,6,7;</entry>

<entry key="eiel_indicadores_ii_depositos_mun">
INSERT INTO eiel_indicadores_d_depositos(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, codpoblamiento,
            capacidadtotal, capacidad_b, capacidad_r, capacidad_m, 
            ndepositosTotal, ndepositos_b, ndepositos_r, ndepositos_m)


SELECT 
        m."GEOMETRY", (n.codprov||n.codmunic) as id_municipio,m.nombreoficial,
        n.codprov as codprov, n.codmunic as codmunic, null as codentidad, null as codpoblamiento

       ,(SELECT SUM(tde.capacidad) FROM  eiel_c_abast_de de 
                               LEFT JOIN eiel_t_abast_de tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_de = tde.orden_de) 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",m."GEOMETRY") ) as capacidadTotal


       ,(SELECT SUM(tde.capacidad) FROM  eiel_c_abast_de de 
                                JOIN eiel_t_abast_de tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_de = tde.orden_de and tde.estado='B') 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",m."GEOMETRY") ) as capacidadEstadoB
       ,(SELECT SUM(tde.capacidad) FROM  eiel_c_abast_de de 
                                JOIN eiel_t_abast_de tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_de = tde.orden_de and tde.estado='R') 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",m."GEOMETRY") ) as capacidadEstadoR
       ,(SELECT SUM(tde.capacidad) FROM  eiel_c_abast_de de 
                                JOIN eiel_t_abast_de tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_de = tde.orden_de and tde.estado='M') 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",m."GEOMETRY") ) as capacidadEstadoM
                                        
       ,(SELECT COUNT(*) FROM  eiel_c_abast_de de 
                               LEFT JOIN eiel_t_abast_de tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_de = tde.orden_de) 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",m."GEOMETRY") ) as numDepositosNucleo

       ,(SELECT COUNT(*) FROM  eiel_c_abast_de de 
                                JOIN eiel_t_abast_de tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_de = tde.orden_de and tde.estado='B') 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",m."GEOMETRY") ) as nmun_depositos_b
       ,(SELECT COUNT(*) FROM  eiel_c_abast_de de 
                                JOIN eiel_t_abast_de tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_de = tde.orden_de and tde.estado='R') 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",m."GEOMETRY") ) as nmun_depositos_r
       ,(SELECT COUNT(*) FROM  eiel_c_abast_de de 
                               JOIN eiel_t_abast_de tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_de = tde.orden_de and tde.estado='M') 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",m."GEOMETRY") ) as nmun_depositos_m    




FROM  municipios m, eiel_c_nucleo_poblacion n 
WHERE m.id=?M and  n.codprov=m.id_provincia and n.codmunic=m.id_ine and srid(m."GEOMETRY")=4230
      --and n.revision_expirada=9999999999  
group by 1,2,3,4,5,6,7
ORDER by 2,4,5,6,7;
</entry>

<entry key="eiel_indicadores_ii_depositos_nuc">
INSERT INTO eiel_indicadores_d_depositos(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, codpoblamiento,
            capacidadtotal, capacidad_b, capacidad_r, capacidad_m, 
            ndepositosTotal, ndepositos_b, ndepositos_r, ndepositos_m)
SELECT 
        n."GEOMETRY", (n.codprov||n.codmunic) as idmunicipio,n.nombre_oficial,
         n.codprov, n.codmunic, n.codentidad, n.codpoblamiento

       ,(SELECT SUM(tde.capacidad) FROM  eiel_c_abast_de de 
                               LEFT JOIN eiel_t_abast_de tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_de = tde.orden_de) 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",n."GEOMETRY") ) as capacidadTotal
       ,(SELECT SUM(tde.capacidad) FROM  eiel_c_abast_de de 
                                JOIN eiel_t_abast_de tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_de = tde.orden_de and tde.estado='B') 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",n."GEOMETRY") ) as capacidadTotal_B  
       ,(SELECT SUM(tde.capacidad) FROM  eiel_c_abast_de de 
                                JOIN eiel_t_abast_de tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_de = tde.orden_de and tde.estado='R') 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",n."GEOMETRY") ) as capacidadTotal_R        
       ,(SELECT SUM(tde.capacidad) FROM  eiel_c_abast_de de 
                                JOIN eiel_t_abast_de tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_de = tde.orden_de and tde.estado='M') 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",n."GEOMETRY") ) as capacidadTotal_M                                                      
         
       ,(SELECT COUNT(*) FROM  eiel_c_abast_de de 
                               LEFT JOIN eiel_t_abast_de tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_de = tde.orden_de) 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",n."GEOMETRY") ) as numDepositosNucleo

       ,(SELECT COUNT(*) FROM  eiel_c_abast_de de 
                                JOIN eiel_t_abast_de tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_de = tde.orden_de and tde.estado='B') 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",n."GEOMETRY") ) as nmun_depositos_b
       ,(SELECT COUNT(*) FROM  eiel_c_abast_de de 
                                JOIN eiel_t_abast_de tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_de = tde.orden_de and tde.estado='R') 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",n."GEOMETRY") ) as nmun_depositos_r
       ,(SELECT COUNT(*) FROM  eiel_c_abast_de de 
                               JOIN eiel_t_abast_de tde ON (de.clave = tde.clave aND de.codmunic = tde.codmunic AND de.codprov = tde.codprov AND de.orden_de = tde.orden_de and tde.estado='M') 
                               WHERE n.codprov=de.codprov and n.codmunic=de.codmunic and St_Within(de."GEOMETRY",n."GEOMETRY") ) as nmun_depositos_m    




FROM  eiel_c_nucleo_poblacion n 
WHERE n.codprov='?p' and n.codmunic='?m' 
      --and n.revision_expirada=9999999999
group by 1,2,3,4,5,6,7
ORDER by 2,4,5,6,7;
</entry>

<entry key="eiel_indicadores_ii_rdistribucion_pre">

INSERT INTO eiel_indicadores_t_rdistribucion_aux(
            "GEOMETRY", id_municipio, nombre_oficial, codprov, codmunic, 
            codentidad, codpoblamiento, rdistrib_calidad, rdistrib_viviendas_sin_conexion, 
            rd_longitud_estado_B,rd_longitud_estado_R,rd_longitud_estado_M, consumoinvierno, consumoverano, rdistrib_au_nviviendas, 
            habitantesabastecimientoautonomo, pobestabastecimientoautnomo, 
            habitantes, pobestacional)
SELECT 
       n."GEOMETRY", n.id_municipio, n.nombre_oficial
       ,n.codprov, n.codmunic, n.codentidad, n.codpoblamiento

       ,rserv.calidad_serv as rdistrib_calidad
       ,rserv.viviendas_s_conexion as rdistrib_viviendas_sin_conexion

       ,(SELECT SUM(longitud) FROM eiel_c_abast_rd as rd WHERE n.codprov=rd.codprov and n.codmunic=rd.codmunic and n.codentidad=rd.codentidad and n.codpoblamiento=rd.codpoblamiento and rd.estado='B') as rd_longitud_estado_B
       ,(SELECT SUM(longitud) FROM eiel_c_abast_rd as rd WHERE n.codprov=rd.codprov and n.codmunic=rd.codmunic and n.codentidad=rd.codentidad and n.codpoblamiento=rd.codpoblamiento and rd.estado='R') as rd_longitud_estado_R
       ,(SELECT SUM(longitud) FROM eiel_c_abast_rd as rd WHERE n.codprov=rd.codprov and n.codmunic=rd.codmunic and n.codentidad=rd.codentidad and n.codpoblamiento=rd.codpoblamiento and rd.estado='M') as rd_longitud_estado_M
              
       
       ,SUM(rserv.consumo_inv)  as consumoInvierno
       ,SUM(rserv.consumo_verano)  as consumoVerano

       ,SUM(rau.aau_vivien )    as rdistrib_au_nviviendas
       ,SUM(rau.aau_pob_re)     as habitantesAbastecimientoAutonomo
       ,SUM(rau.aau_pob_es)     as pobestAbastecimientoAutnomo
       
       ,SUM(ne.padron) as habitantes
       ,SUM(ne.pob_estacional) as pobEstacional


FROM 
     (eiel_c_nucleo_poblacion n 
      JOIN eiel_t_nucl_encuest_1 ne ON ( n.codprov=ne.codprov and n.codmunic=ne.codmunic and n.codentidad=ne.codentidad and n.codpoblamiento=ne.codpoblamiento and ne.revision_expirada=9999999999 ) ) 
      LEFT JOIN eiel_t_abast_serv rserv ON (n.codprov=rserv.codprov and n.codmunic=rserv.codmunic and n.codentidad=rserv.codentidad and n.codpoblamiento=rserv.codpoblamiento) 
      LEFT JOIN eiel_t_abast_au rau ON (n.codprov=rau.codprov and n.codmunic=rau.codmunic and n.codentidad=rau.codentidad and n.codpoblamiento=rau.codpoblamiento) 
      LEFT JOIN eiel_c_abast_rd rd ON (n.codprov=rd.codprov and n.codmunic=rd.codmunic and n.codentidad=rd.codentidad and n.codpoblamiento=rd.codpoblamiento)

where   n.codprov='?p' and n.codmunic='?m'  and 
       ( n.codprov=ne.codprov and n.codmunic=ne.codmunic and n.codentidad=ne.codentidad and n.codpoblamiento=ne.codpoblamiento)
       --and n.revision_expirada=9999999999   
  

GROUP BY 1,2,3,4,5,6,7,8,9
ORDER BY 2,4,5,6,7;
</entry>
<entry key="eiel_indicadores_ii_rdistribucion_mun">
INSERT INTO eiel_indicadores_d_rdistribucion(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, 
            codpoblamiento, numnucleos, numnucleoscalidadrd_b, numnucleoscalidadrd_r, 
            numnucleoscalidadrd_m, habitantescalidadrd_b, habitantescalidadrd_r, 
            habitantescalidadrd_m, pobestacionalcalidadrd_b, pobestacionalcalidadrd_r, 
            pobestacionalcalidadrd_m, rd_longitud_estado_b, rd_longitud_estado_r, 
            rd_longitud_estado_m, consumoinvierno, consumoverano, rdistrib_viviendas_sin_conexion, 
            rdistrib_viviendas_au, rdistrib_habitantes_au, rdistrib_pobest_au)

SELECT 
       m."GEOMETRY",
       m.id as idmunicipio,m.nombreoficial
         ,m.id_provincia, m.id_ine, null, null



       ,(SELECT COUNT(*) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE m.id_provincia=raux.codprov and m.id_ine=raux.codmunic   ) as numNucleos
       ,(SELECT COUNT(*) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE m.id_provincia=raux.codprov and m.id_ine=raux.codmunic and raux.rdistrib_calidad='B' ) as numNucleosCalidadRD_B
       ,(SELECT COUNT(*) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE m.id_provincia=raux.codprov and m.id_ine=raux.codmunic and raux.rdistrib_calidad='R' ) as numNucleosCalidadRD_R
       ,(SELECT COUNT(*) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE m.id_provincia=raux.codprov and m.id_ine=raux.codmunic and raux.rdistrib_calidad='M' ) as numNucleosCalidadRD_M

       ,(SELECT SUM(habitantes) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE m.id_provincia=raux.codprov and m.id_ine=raux.codmunic and raux.rdistrib_calidad='B' ) as habitantesCalidadRD_B
       ,(SELECT SUM(habitantes) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE m.id_provincia=raux.codprov and m.id_ine=raux.codmunic and raux.rdistrib_calidad='R' ) as habitantesCalidadRD_R
       ,(SELECT SUM(habitantes) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE m.id_provincia=raux.codprov and m.id_ine=raux.codmunic and raux.rdistrib_calidad='M' ) as habitantesCalidadRD_M

       ,(SELECT SUM(pobEstacional) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE m.id_provincia=raux.codprov and m.id_ine=raux.codmunic and raux.rdistrib_calidad='B' ) as pobestacionalCalidadRD_B
       ,(SELECT SUM(pobEstacional) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE m.id_provincia=raux.codprov and m.id_ine=raux.codmunic and raux.rdistrib_calidad='R' ) as pobestacionalCalidadRD_R
       ,(SELECT SUM(pobEstacional) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE m.id_provincia=raux.codprov and m.id_ine=raux.codmunic and raux.rdistrib_calidad='M' ) as pobestacionalCalidadRD_M       


       ,(SELECT SUM(rd_longitud_estado_B) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE m.id_provincia=raux.codprov and m.id_ine=raux.codmunic  ) as rd_longitud_estado_B
       ,(SELECT SUM(rd_longitud_estado_R) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE m.id_provincia=raux.codprov and m.id_ine=raux.codmunic  ) as rd_longitud_estado_R
       ,(SELECT SUM(rd_longitud_estado_M) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE m.id_provincia=raux.codprov and m.id_ine=raux.codmunic  ) as rd_longitud_estado_M

       ,(SELECT SUM(consumoInvierno) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE m.id_provincia=raux.codprov and m.id_ine=raux.codmunic  ) as consumoInvierno
       ,(SELECT SUM(consumoVerano) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE m.id_provincia=raux.codprov and m.id_ine=raux.codmunic ) as consumoVerano

       ,(SELECT SUM(rdistrib_viviendas_sin_conexion) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE m.id_provincia=raux.codprov and m.id_ine=raux.codmunic  ) as rdistrib_viviendas_sin_conexion
       ,(SELECT SUM(rdistrib_au_nviviendas) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE m.id_provincia=raux.codprov and m.id_ine=raux.codmunic  ) as rdistrib_viviendas_au
       ,(SELECT SUM(habitantesAbastecimientoAutonomo) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE m.id_provincia=raux.codprov and m.id_ine=raux.codmunic  ) as rdistrib_habitantes_au
       ,(SELECT SUM(pobestAbastecimientoAutnomo) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE m.id_provincia=raux.codprov and m.id_ine=raux.codmunic  ) as rdistrib_pobest_au



FROM  municipios m
WHERE m.id=?M and srid(m."GEOMETRY")=4230 
GROUP BY 1,2,3,4,5
ORDER BY 2,4,5,6,7;
</entry>
<entry key="eiel_indicadores_ii_rdistribucion_nuc">

INSERT INTO eiel_indicadores_d_rdistribucion(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, 
            codpoblamiento, numnucleos, numnucleoscalidadrd_b, numnucleoscalidadrd_r, 
            numnucleoscalidadrd_m, habitantescalidadrd_b, habitantescalidadrd_r, 
            habitantescalidadrd_m, pobestacionalcalidadrd_b, pobestacionalcalidadrd_r, 
            pobestacionalcalidadrd_m, rd_longitud_estado_b, rd_longitud_estado_r, 
            rd_longitud_estado_m, consumoinvierno, consumoverano, rdistrib_viviendas_sin_conexion, 
            rdistrib_viviendas_au, rdistrib_habitantes_au, rdistrib_pobest_au)

SELECT 
       n."GEOMETRY", n.id_municipio, n.nombre_oficial as toponimo
       ,n.codprov, n.codmunic, n.codentidad, n.codpoblamiento



       ,(SELECT COUNT(*) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento  ) as numNucleos
       ,(SELECT COUNT(*) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento and raux.rdistrib_calidad='B' ) as numNucleosCalidadRD_B
       ,(SELECT COUNT(*) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento and raux.rdistrib_calidad='R' ) as numNucleosCalidadRD_R
       ,(SELECT COUNT(*) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento and raux.rdistrib_calidad='M' ) as numNucleosCalidadRD_M

       ,(SELECT SUM(habitantes) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento and raux.rdistrib_calidad='B' ) as habitantesCalidadRD_B
       ,(SELECT SUM(habitantes) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento and raux.rdistrib_calidad='R' ) as habitantesCalidadRD_R
       ,(SELECT SUM(habitantes) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento and raux.rdistrib_calidad='M' ) as habitantesCalidadRD_M

       ,(SELECT SUM(pobEstacional) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento and raux.rdistrib_calidad='B' ) as pobestacionalCalidadRD_B
       ,(SELECT SUM(pobEstacional) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento and raux.rdistrib_calidad='R' ) as pobestacionalCalidadRD_R
       ,(SELECT SUM(pobEstacional) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento and raux.rdistrib_calidad='M' ) as pobestacionalCalidadRD_M       


       ,(SELECT SUM(rd_longitud_estado_B) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento ) as rd_longitud_estado_B
       ,(SELECT SUM(rd_longitud_estado_R) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento ) as rd_longitud_estado_R
       ,(SELECT SUM(rd_longitud_estado_M) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento ) as rd_longitud_estado_M

       ,(SELECT SUM(consumoInvierno) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento ) as consumoInvierno
       ,(SELECT SUM(consumoVerano) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento ) as consumoVerano

       ,(SELECT SUM(rdistrib_viviendas_sin_conexion) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento ) as rdistrib_viviendas_sin_conexion
       ,(SELECT SUM(rdistrib_au_nviviendas) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento ) as rdistrib_viviendas_au
       ,(SELECT SUM(habitantesAbastecimientoAutonomo) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento ) as rdistrib_habitantes_au
       ,(SELECT SUM(pobestAbastecimientoAutnomo) FROM eiel_indicadores_t_rdistribucion_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento ) as rdistrib_pobest_au



FROM 
     eiel_c_nucleo_poblacion n 
      
WHERE n.codprov='?p' and n.codmunic='?m' 
      --and n.revision_expirada=9999999999
ORDER BY 2,4,5,6,7;
</entry>
<entry key="eiel_indicadores_ii_rsaneamiento_pre">

INSERT INTO eiel_indicadores_d_rsaneam_aux(
            "GEOMETRY", id_municipio, nombre_oficial, codprov, codmunic, 
            codentidad, codpoblamiento, saneam_calidad, saneam_viviendas_sin_conexion, 
            saneam_viviendas_con_conexion, rs_longitud_estado_b, rs_longitud_estado_r, 
            rs_longitud_estado_m, rs_longitud_def, rsaneam_au_nviviendas, 
            habitantessaneamientoautonomo, pobestsaneamientoautnomo, rsaneam_au_nviviendas_insuficiente, 
            habitantessaneamientoautonomo_insuficiente, pobestsaneamientoautonomo_insuficiente, 
            habitantes, pobestacional)
SELECT 
       n."GEOMETRY", n.id_municipio, n.nombre_oficial
       ,n.codprov, n.codmunic, n.codentidad, n.codpoblamiento

       ,sserv.calidad_serv as saneam_calidad
       ,sserv.viviendas_s_conex as saneam_viviendas_sin_conexion
       ,sserv.viviendas_c_conex as saneam_viviendas_con_conexion      

       ,(SELECT SUM(longitud) FROM eiel_c_saneam_rs as rs WHERE n.codprov=rs.codprov and n.codmunic=rs.codmunic and n.codentidad=rs.codentidad and n.codpoblamiento=rs.codpoblamiento and rs.estado='B') as rs_longitud_estado_B
       ,(SELECT SUM(longitud) FROM eiel_c_saneam_rs as rs WHERE n.codprov=rs.codprov and n.codmunic=rs.codmunic and n.codentidad=rs.codentidad and n.codpoblamiento=rs.codpoblamiento and rs.estado='R') as rs_longitud_estado_R
       ,(SELECT SUM(longitud) FROM eiel_c_saneam_rs as rs WHERE n.codprov=rs.codprov and n.codmunic=rs.codmunic and n.codentidad=rs.codentidad and n.codpoblamiento=rs.codpoblamiento and rs.estado='M') as rs_longitud_estado_M
	,(SELECT SUM(long_rs_deficit) FROM eiel_t_saneam_serv as rs WHERE n.codprov=rs.codprov and n.codmunic=rs.codmunic and n.codentidad=rs.codentidad and n.codpoblamiento=rs.codpoblamiento) as rs_longitud_def       

       ,SUM(sau.sau_vivien )    as rsaneam_au_nviviendas
       ,SUM(sau.sau_pob_re)     as habitantesSaneamientoAutonomo
       ,SUM(sau.sau_pob_es)     as pobestSaneamientoAutnomo
       
       ,SUM(sau.sau_vi_def )    as rsaneam_au_nviviendas_Insuficiente
       ,SUM(sau.sau_pob_re_def)     as habitantesSaneamientoAutonomo_Insuficiente
       ,SUM(sau.sau_pob_es_def)     as pobestSaneamientoAutonomo_Insuficiente     

       ,SUM(ne.padron) as habitantes
       ,SUM(ne.pob_estacional) as pobEstacional

FROM 
     (eiel_c_nucleo_poblacion n 
      JOIN eiel_t_nucl_encuest_1 ne ON ( n.codprov=ne.codprov and n.codmunic=ne.codmunic and n.codentidad=ne.codentidad and n.codpoblamiento=ne.codpoblamiento and ne.revision_expirada=9999999999) ) 
      LEFT JOIN eiel_t_saneam_serv sserv ON (n.codprov=sserv.codprov and n.codmunic=sserv.codmunic and n.codentidad=sserv.codentidad and n.codpoblamiento=sserv.codpoblamiento) 
      LEFT JOIN eiel_t_saneam_au sau ON (n.codprov=sau.codprov and n.codmunic=sau.codmunic and n.codentidad=sau.codentidad and n.codpoblamiento=sau.codpoblamiento) 
      LEFT JOIN eiel_c_saneam_rs rs ON (n.codprov=rs.codprov and n.codmunic=rs.codmunic and n.codentidad=rs.codentidad and n.codpoblamiento=rs.codpoblamiento)

WHERE   n.codprov='?p' and n.codmunic='?m' and
       ( n.codprov=ne.codprov and n.codmunic=ne.codmunic and n.codentidad=ne.codentidad and n.codpoblamiento=ne.codpoblamiento)  
       -- and n.revision_expirada=9999999999 
GROUP BY 1,2,3,4,5,6,7,8,9,10
ORDER BY 2,4,5,6,7;
</entry>
<entry key="eiel_indicadores_ii_rsaneamiento_mun">

INSERT INTO eiel_indicadores_d_rsaneam(
            "GEOMETRY",id_municipio, toponimo,  codprov, codmunic, codentidad, codpoblamiento, 
            nnucleos_calidadred_b, nnucleos_calidadred_r, nnucleos_calidadred_m, 
            nhab_calidadred_b, nhab_calidadred_r,  nhab_calidadred_ma,
            nest_calidadred_b, nest_calidadred_r, nest_calidadred_m, 
            nviv_saneamautonomo, nhab_saneamautonomo, nest_saneamautonomo,           
            nviv_saneamautonomo_in, nhab_saneamautonomo_in, nest_saneamautonomo_in ,
            saneam_viviendas_con_conexion,saneam_viviendas_sin_conexion,
           rs_longitud_estado_B,rs_longitud_estado_R,rs_longitud_estado_M,rs_longitud_def 
            )

SELECT 
       m."GEOMETRY",
        (n.codprov||n.codmunic) as idmunicipio,m.nombreoficial
         ,n.codprov, n.codmunic, null, null


       ,(SELECT COUNT(*) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic  and raux.saneam_calidad='B' ) as nnucleos_calidadred_b
       ,(SELECT COUNT(*) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic  and raux.saneam_calidad='R' ) as nnucleos_calidadred_r
       ,(SELECT COUNT(*) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic  and raux.saneam_calidad='M' ) as nnucleos_calidadred_m

       ,(SELECT SUM(habitantes) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic  and raux.saneam_calidad='B' ) as nhab_calidadred_b
       ,(SELECT SUM(habitantes) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic  and raux.saneam_calidad='R' ) as nhab_calidadred_r
       ,(SELECT SUM(habitantes) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic  and raux.saneam_calidad='M' ) as nhab_calidadred_ma

       ,(SELECT SUM(pobEstacional) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic  and raux.saneam_calidad='B' ) as nest_calidadred_b
       ,(SELECT SUM(pobEstacional) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic  and raux.saneam_calidad='R' ) as nest_calidadred_r
       ,(SELECT SUM(pobEstacional) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic  and raux.saneam_calidad='M' ) as nest_calidadred_m
       
       ,(SELECT SUM(rsaneam_au_nviviendas) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic ) as nviv_saneamautonomo       
       ,(SELECT SUM(habitantessaneamientoautonomo) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic   ) as nhab_saneamautonomo   
       ,(SELECT SUM(pobestsaneamientoautnomo) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic   ) as nest_saneamautonomo  

       ,(SELECT SUM(rsaneam_au_nviviendas_insuficiente) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic  ) as nviv_saneamautonomo_in       
       ,(SELECT SUM(habitantessaneamientoautonomo_insuficiente) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic  ) as nhab_saneamautonomo_in   
       ,(SELECT SUM(pobestsaneamientoautonomo_insuficiente) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic   ) as nest_saneamautonomo_in  

       ,(SELECT SUM(saneam_viviendas_con_conexion) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic  ) as saneam_viviendas_con_conexion
       ,(SELECT SUM(saneam_viviendas_sin_conexion) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic  ) as saneam_viviendas_sin_conexion


       ,(SELECT SUM(rs_longitud_estado_b) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic  ) as rs_longitud_estado_B
       ,(SELECT SUM(rs_longitud_estado_r) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic  ) as rs_longitud_estado_R
       ,(SELECT SUM(rs_longitud_estado_m) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic  ) as rs_longitud_estado_M
       ,(SELECT SUM(rs_longitud_def) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic  ) as rs_longitud_def
       

FROM  municipios m, eiel_c_nucleo_poblacion n 
WHERE m.id=?M and  n.codprov=m.id_provincia and n.codmunic=m.id_ine  and srid(m."GEOMETRY")=4230 
      --and n.revision_expirada=9999999999
GROUP BY 1,2,3,4,5
ORDER BY 2,4,5,6,7;
</entry>

<entry key="eiel_indicadores_ii_rsaneamiento_nuc">

INSERT INTO eiel_indicadores_d_rsaneam(
            "GEOMETRY",id_municipio, toponimo,  codprov, codmunic, codentidad, codpoblamiento, 
            nnucleos_calidadred_b, nnucleos_calidadred_r, nnucleos_calidadred_m, 
            nhab_calidadred_b, nhab_calidadred_r,  nhab_calidadred_ma,
            nest_calidadred_b, nest_calidadred_r, nest_calidadred_m, 
            nviv_saneamautonomo, nhab_saneamautonomo, nest_saneamautonomo,           
            nviv_saneamautonomo_in, nhab_saneamautonomo_in, nest_saneamautonomo_in ,
            saneam_viviendas_con_conexion,saneam_viviendas_sin_conexion,
           rs_longitud_estado_B,rs_longitud_estado_R,rs_longitud_estado_M,rs_longitud_def 
            )

SELECT 
       n."GEOMETRY", n.id_municipio, n.nombre_oficial as toponimo
       ,n.codprov, n.codmunic, n.codentidad, n.codpoblamiento



       ,(SELECT COUNT(*) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento and raux.saneam_calidad='B' ) as nnucleos_calidadred_b
       ,(SELECT COUNT(*) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento and raux.saneam_calidad='R' ) as nnucleos_calidadred_r
       ,(SELECT COUNT(*) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento and raux.saneam_calidad='M' ) as nnucleos_calidadred_m

       ,(SELECT SUM(habitantes) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento and raux.saneam_calidad='B' ) as nhab_calidadred_b
       ,(SELECT SUM(habitantes) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento and raux.saneam_calidad='R' ) as nhab_calidadred_r
       ,(SELECT SUM(habitantes) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento and raux.saneam_calidad='M' ) as nhab_calidadred_ma

       ,(SELECT SUM(pobEstacional) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento and raux.saneam_calidad='B' ) as nest_calidadred_b
       ,(SELECT SUM(pobEstacional) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento and raux.saneam_calidad='R' ) as nest_calidadred_r
       ,(SELECT SUM(pobEstacional) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento and raux.saneam_calidad='M' ) as nest_calidadred_m
       
       ,(SELECT SUM(rsaneam_au_nviviendas) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento) as nviv_saneamautonomo       
       ,(SELECT SUM(habitantessaneamientoautonomo) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento  ) as nhab_saneamautonomo   
       ,(SELECT SUM(pobestsaneamientoautnomo) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento  ) as nest_saneamautonomo  

       ,(SELECT SUM(rsaneam_au_nviviendas_insuficiente) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento ) as nviv_saneamautonomo_in       
       ,(SELECT SUM(habitantessaneamientoautonomo_insuficiente) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento ) as nhab_saneamautonomo_in   
       ,(SELECT SUM(pobestsaneamientoautonomo_insuficiente) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento  ) as nest_saneamautonomo_in  

       ,(SELECT SUM(saneam_viviendas_con_conexion) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento ) as saneam_viviendas_con_conexion
       ,(SELECT SUM(saneam_viviendas_sin_conexion) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento ) as saneam_viviendas_sin_conexion


       ,(SELECT SUM(rs_longitud_estado_b) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento ) as rs_longitud_estado_B
       ,(SELECT SUM(rs_longitud_estado_r) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento ) as rs_longitud_estado_R
       ,(SELECT SUM(rs_longitud_estado_m) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento ) as rs_longitud_estado_M
       ,(SELECT SUM(rs_longitud_def) FROM eiel_indicadores_d_rsaneam_aux as raux WHERE n.codprov=raux.codprov and n.codmunic=raux.codmunic and n.codentidad=raux.codentidad and n.codpoblamiento=raux.codpoblamiento ) as rs_longitud_def
       


FROM 
     eiel_c_nucleo_poblacion n 

WHERE n.codprov='?p' and n.codmunic='?m' 
      --and n.revision_expirada=9999999999
ORDER BY 2,4,5,6,7;
</entry>
<entry key="eiel_indicadores_ii_vertidos_mun">
INSERT INTO eiel_indicadores_d_vertidos(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, codpoblamiento,
             npuntosvertido)
SELECT 
       m."GEOMETRY" as "GEOMETRY",
       m.id as id_municipio, null as toponimo
       ,m.id_provincia as codprov, m.id_ine as codmunic,  null as codentidad , null as codpoblamiento
       ,COUNT(*)
FROM 
     municipios m 
     LEFT JOIN eiel_c_saneam_pv pv ON ( pv.codprov=m.id_provincia and pv.codmunic=m.id_ine)   

WHERE m.id=?M and srid(pv."GEOMETRY")=srid(m."GEOMETRY")
GROUP BY 1,2,3,4,5
ORDER BY 2,3,4,5,6 ;
</entry>
<entry key="eiel_indicadores_ii_vertidos_nuc">
INSERT INTO eiel_indicadores_d_vertidos(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, codpoblamiento,
             npuntosvertido)
SELECT 
       n."GEOMETRY" as "GEOMETRY",
       (n.codprov||n.codmunic) as id_municipio, n.nombre_oficial as toponimo
       ,n.codprov, n.codmunic as codmunic, n.codentidad as codentidad , n.codpoblamiento as codpoblamiento
       ,COUNT(*)
FROM 
     eiel_c_nucleo_poblacion n 
     LEFT JOIN eiel_c_saneam_pv pv ON ( pv.codprov=n.codprov and pv.codmunic=n.codmunic and ST_Within(pv."GEOMETRY", n."GEOMETRY") )
WHERE n.codprov='?p' and n.codmunic='?m'  and srid(pv."GEOMETRY")=srid(n."GEOMETRY")
      -- and n.revision_expirada=9999999999
GROUP BY 1,2,3,4,5,6,7
ORDER BY 2,3,4,5,6 ;
</entry>
<entry key="eiel_indicadores_ii_depuracion_mun"></entry>
<entry key="eiel_indicadores_ii_depuracion_nuc"></entry>

<entry key="eiel_indicadores_iii_accesibilidad_mun">
INSERT INTO eiel_indicadores_d_accesibilidad(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, 
            codpoblamiento, nnuc_accesibilidadd, nhab_accesibilidadd, nest_accesibilidadd)

SELECT 
        m."GEOMETRY",m.id as id_municipio, m.nombreoficial
       ,m.id_provincia, m.id_ine,  null as codentidad, null as codpoblamiento

       ,COUNT(ne.codmunic)   as numNucleosMunicipioProblemasAccesibilidad
       ,COALESCE(SUM(ne.padron),0)    as poblacioNucleosMunicipioProblemasAccesibilidad
       ,COALESCE(SUM(ne.pob_estacional),0) as poblacioNucleosMunicipioProblemasAccesibilidad


FROM 
     municipios m 
      LEFT JOIN 
     eiel_t_nucl_encuest_1 ne ON

 ( m.id_provincia=ne.codprov and m.id_ine=ne.codmunic and ne.accesibilidad='SI'  and ne.revision_expirada=9999999999 )
WHERE m.id=?M and  srid(m."GEOMETRY")=4230
GROUP BY 1,2,3,4,5,6,7
ORDER BY 2,3,4,5,6;

</entry>
<entry key="eiel_indicadores_iii_accesibilidad_nuc">


INSERT INTO eiel_indicadores_d_accesibilidad(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, 
            codpoblamiento, nnuc_accesibilidadd, nhab_accesibilidadd, nest_accesibilidadd)

SELECT 
        n."GEOMETRY" as "GEOMETRY", (nE.codprov || nE.codmunic) as id_municipio, n.nombre_oficial
       ,ne.codprov, ne.codmunic,  ne.codentidad, ne.codpoblamiento

       ,COUNT(*)   as numNucleosMunicipio
       ,SUM(ne.padron)      as poblacionDerechoNucleos
       ,SUM(ne.pob_estacional) as poblacionEstacionalMax   


FROM 
     eiel_c_nucleo_poblacion n , 
     eiel_t_nucl_encuest_1 ne 
WHERE n.codprov='?p' and n.codmunic='?m' and
 ( n.codprov=ne.codprov and n.codmunic=ne.codmunic and n.codentidad=ne.codentidad and n.codpoblamiento=ne.codpoblamiento and ne.accesibilidad='SI' and ne.revision_expirada=9999999999 )
 --and n.revision_expirada=9999999999 
GROUP BY 1,2,3,4,5,6,7
ORDER BY 2,3,4,5,6;

</entry>

<entry key="eiel_indicadores_iii_pavimentacion_mun">
INSERT INTO eiel_indicadores_d_pavimentacion(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, codpoblamiento, 
            travesias_longitud_b, travesias_longitud_r, travesias_longitud_m,travesias_longitud_NP,travesias_longitud_E,
            carreteras_longitud_b,carreteras_longitud_r,carreteras_longitud_m,
            calles_longitud_b,calles_longitud_r,calles_longitud_m,calles_longitud_NP,calles_longitud_E,
            plazas_longitud_b,plazas_longitud_r,plazas_longitud_m,plazas_longitud_NP,plazas_longitud_E,
            otros_longitud_b,otros_longitud_r,otros_longitud_m,otros_longitud_NP,otros_longitud_E)

SELECT 
        m."GEOMETRY" as "GEOMETRY", m.id as id_municipio, m.nombreoficial
       ,m.id_provincia, m.id_ine,  null as codentidad, null as codpoblamiento

       , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  m.id_provincia=tu.codprov and m.id_ine=tu.codmunic  and  tu.tipo='TR' and  estado='B'  and tu.revision_expirada=9999999999
        ) as travesias_longitud_b
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  m.id_provincia=tu.codprov and m.id_ine=tu.codmunic  and  tu.tipo='TR' and    estado='R' and tu.revision_expirada=9999999999
           ) as travesias_longitud_r
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  m.id_provincia=tu.codprov and m.id_ine=tu.codmunic  and  tu.tipo='TR' and    estado='M' and tu.revision_expirada=9999999999       
          ) as travesias_longitud_m
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  m.id_provincia=tu.codprov and m.id_ine=tu.codmunic  and  tu.tipo='TR' and    estado='NP' and tu.revision_expirada=9999999999
           ) as travesias_longitud_NP
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  m.id_provincia=tu.codprov and m.id_ine=tu.codmunic  and  tu.tipo='TR' and    estado='E' and tu.revision_expirada=9999999999       
          ) as travesias_longitud_E          
          
       , ( SELECT SUM(longitud) FROM eiel_c_tramos_carreteras ca where  m.id_provincia= ca.codprov and m.id_ine=ca.codmunic and srid(ca."GEOMETRY") = srid(m."GEOMETRY") and ST_Within(ca."GEOMETRY",m."GEOMETRY") and    
            estado='B' 
            --and ca.revision_expirada=9999999999
              ) as carreteras_longitud_b        
       , ( SELECT SUM(longitud) FROM eiel_c_tramos_carreteras ca where  m.id_provincia= ca.codprov and m.id_ine=ca.codmunic and srid(ca."GEOMETRY") = srid(m."GEOMETRY") and ST_Within(ca."GEOMETRY",m."GEOMETRY") and    
            estado='R' 
            --and ca.revision_expirada=9999999999
              ) as carreteras_longitud_r
       , ( SELECT SUM(longitud) FROM eiel_c_tramos_carreteras ca where  m.id_provincia= ca.codprov and m.id_ine=ca.codmunic and srid(ca."GEOMETRY") = srid(m."GEOMETRY") and ST_Within(ca."GEOMETRY",m."GEOMETRY") and    
            estado='M' 
            --and ca.revision_expirada=9999999999
              ) as carreteras_longitud_m      
              
       , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  m.id_provincia=tu.codprov and m.id_ine=tu.codmunic  and  tu.tipo='CA' and  estado='B'  and tu.revision_expirada=9999999999
        ) as calles_longitud_b
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  m.id_provincia=tu.codprov and m.id_ine=tu.codmunic  and  tu.tipo='CA' and    estado='R' and tu.revision_expirada=9999999999
           ) as calles_longitud_r
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  m.id_provincia=tu.codprov and m.id_ine=tu.codmunic  and  tu.tipo='CA' and    estado='M' and tu.revision_expirada=9999999999       
          ) as calles_longitud_m
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  m.id_provincia=tu.codprov and m.id_ine=tu.codmunic  and  tu.tipo='CA' and    estado='NP' and tu.revision_expirada=9999999999
           ) as calles_longitud_NP
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  m.id_provincia=tu.codprov and m.id_ine=tu.codmunic  and  tu.tipo='CA' and    estado='E' and tu.revision_expirada=9999999999       
          ) as calles_longitud_E
          
       , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  m.id_provincia=tu.codprov and m.id_ine=tu.codmunic  and  tu.tipo='PZ' and  estado='B'  and tu.revision_expirada=9999999999
        ) as plazas_longitud_b
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  m.id_provincia=tu.codprov and m.id_ine=tu.codmunic  and  tu.tipo='PZ' and    estado='R' and tu.revision_expirada=9999999999
           ) as plazas_longitud_r
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  m.id_provincia=tu.codprov and m.id_ine=tu.codmunic  and  tu.tipo='PZ' and    estado='M' and tu.revision_expirada=9999999999       
          ) as plazas_longitud_m
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  m.id_provincia=tu.codprov and m.id_ine=tu.codmunic  and  tu.tipo='PZ' and    estado='NP' and tu.revision_expirada=9999999999
           ) as plazas_longitud_NP
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  m.id_provincia=tu.codprov and m.id_ine=tu.codmunic  and  tu.tipo='PZ' and    estado='E' and tu.revision_expirada=9999999999       
          ) as plazas_longitud_E          

       , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  m.id_provincia=tu.codprov and m.id_ine=tu.codmunic  and  tu.tipo='OT' and  estado='B'  and tu.revision_expirada=9999999999
        ) as otros_longitud_b
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  m.id_provincia=tu.codprov and m.id_ine=tu.codmunic  and  tu.tipo='OT' and    estado='R' and tu.revision_expirada=9999999999
           ) as otros_longitud_r
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  m.id_provincia=tu.codprov and m.id_ine=tu.codmunic  and  tu.tipo='OT' and    estado='M' and tu.revision_expirada=9999999999       
          ) as otros_longitud_m
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  m.id_provincia=tu.codprov and m.id_ine=tu.codmunic  and  tu.tipo='OT' and    estado='NP' and tu.revision_expirada=9999999999
           ) as otros_longitud_NP
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  m.id_provincia=tu.codprov and m.id_ine=tu.codmunic  and  tu.tipo='OT' and    estado='E' and tu.revision_expirada=9999999999       
          ) as otros_longitud_E
                                                                                 

FROM 
     municipios m    

WHERE
 m.id=?M and srid(m."GEOMETRY")=4230
GROUP BY 1,2,3,4,5,6,7
ORDER BY 2,3,4,5,6;

</entry>

<entry key="eiel_indicadores_iii_pavimentacion_nuc">

INSERT INTO eiel_indicadores_d_pavimentacion(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, codpoblamiento, 
            travesias_longitud_b, travesias_longitud_r, travesias_longitud_m,travesias_longitud_NP,travesias_longitud_E,
            carreteras_longitud_b,carreteras_longitud_r,carreteras_longitud_m,
            calles_longitud_b,calles_longitud_r,calles_longitud_m,calles_longitud_NP,calles_longitud_E,
            plazas_longitud_b,plazas_longitud_r,plazas_longitud_m,plazas_longitud_NP,plazas_longitud_E,
            otros_longitud_b,otros_longitud_r,otros_longitud_m,otros_longitud_NP,otros_longitud_E)

SELECT 
        n."GEOMETRY" as "GEOMETRY", (n.codprov || n.codmunic) as id_municipio, n.nombre_oficial
       ,n.codprov, n.codmunic,  n.codentidad, n.codpoblamiento
       , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  n.codprov=tu.codprov and n.codmunic=tu.codmunic and n.codentidad=tu.codentidad and n.codpoblamiento=tu.codpoblamiento and  tu.tipo='TR' and estado='B' and tu.revision_expirada=9999999999
         ) as travesias_longitud_b
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  n.codprov=tu.codprov and n.codmunic=tu.codmunic and n.codentidad=tu.codentidad and n.codpoblamiento=tu.codpoblamiento and tu.tipo='TR' and estado='R' and tu.revision_expirada=9999999999
        ) as travesias_longitud_r
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  n.codprov=tu.codprov and n.codmunic=tu.codmunic and n.codentidad=tu.codentidad and n.codpoblamiento=tu.codpoblamiento and  tu.tipo='TR' and estado='M' and tu.revision_expirada=9999999999
        ) as travesias_longitud_m
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  n.codprov=tu.codprov and n.codmunic=tu.codmunic and n.codentidad=tu.codentidad and n.codpoblamiento=tu.codpoblamiento and  tu.tipo='TR' and estado='NP' and tu.revision_expirada=9999999999
        ) as travesias_longitud_NP        
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  n.codprov=tu.codprov and n.codmunic=tu.codmunic and n.codentidad=tu.codentidad and n.codpoblamiento=tu.codpoblamiento and  tu.tipo='TR' and estado='E' and tu.revision_expirada=9999999999
        ) as travesias_longitud_E        

       , ( SELECT SUM(longitud) FROM eiel_c_tramos_carreteras ca where  n.codprov= ca.codprov and n.codmunic=ca.codmunic and ST_Within(ca."GEOMETRY",n."GEOMETRY") and    
       estado='B'
 --and ca.revision_expirada=9999999999
        ) as carreteras_longitud_b        
       , ( SELECT SUM(longitud) FROM eiel_c_tramos_carreteras ca where  n.codprov= ca.codprov and n.codmunic=ca.codmunic and ST_Within(ca."GEOMETRY",n."GEOMETRY") and    
       estado='R'
 --and ca.revision_expirada=9999999999
        ) as carreteras_longitud_r
       , ( SELECT SUM(longitud) FROM eiel_c_tramos_carreteras ca where  n.codprov= ca.codprov and n.codmunic=ca.codmunic and ST_Within(ca."GEOMETRY",n."GEOMETRY") and    
       estado='M'
 --and ca.revision_expirada=9999999999
        ) as carreteras_longitud_m   
        
       , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  n.codprov=tu.codprov and n.codmunic=tu.codmunic and n.codentidad=tu.codentidad and n.codpoblamiento=tu.codpoblamiento and  tu.tipo='CA' and estado='B' and tu.revision_expirada=9999999999
         ) as calles_longitud_b
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  n.codprov=tu.codprov and n.codmunic=tu.codmunic and n.codentidad=tu.codentidad and n.codpoblamiento=tu.codpoblamiento and tu.tipo='CA' and estado='R' and tu.revision_expirada=9999999999
        ) as calles_longitud_r
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  n.codprov=tu.codprov and n.codmunic=tu.codmunic and n.codentidad=tu.codentidad and n.codpoblamiento=tu.codpoblamiento and  tu.tipo='CA' and estado='M' and tu.revision_expirada=9999999999
        ) as calles_longitud_m  
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  n.codprov=tu.codprov and n.codmunic=tu.codmunic and n.codentidad=tu.codentidad and n.codpoblamiento=tu.codpoblamiento and tu.tipo='CA' and estado='NP' and tu.revision_expirada=9999999999
        ) as calles_longitud_NP
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  n.codprov=tu.codprov and n.codmunic=tu.codmunic and n.codentidad=tu.codentidad and n.codpoblamiento=tu.codpoblamiento and  tu.tipo='CA' and estado='E' and tu.revision_expirada=9999999999
        ) as calles_longitud_E                  

       , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  n.codprov=tu.codprov and n.codmunic=tu.codmunic and n.codentidad=tu.codentidad and n.codpoblamiento=tu.codpoblamiento and  tu.tipo='PZ' and estado='B' and tu.revision_expirada=9999999999
         ) as plazas_longitud_b
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  n.codprov=tu.codprov and n.codmunic=tu.codmunic and n.codentidad=tu.codentidad and n.codpoblamiento=tu.codpoblamiento and tu.tipo='PZ' and estado='R' and tu.revision_expirada=9999999999
        ) as plazas_longitud_r
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  n.codprov=tu.codprov and n.codmunic=tu.codmunic and n.codentidad=tu.codentidad and n.codpoblamiento=tu.codpoblamiento and  tu.tipo='PZ' and estado='M' and tu.revision_expirada=9999999999
        ) as plazas_longitud_m     
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  n.codprov=tu.codprov and n.codmunic=tu.codmunic and n.codentidad=tu.codentidad and n.codpoblamiento=tu.codpoblamiento and tu.tipo='PZ' and estado='NP' and tu.revision_expirada=9999999999
        ) as plazas_longitud_NP
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  n.codprov=tu.codprov and n.codmunic=tu.codmunic and n.codentidad=tu.codentidad and n.codpoblamiento=tu.codpoblamiento and  tu.tipo='PZ' and estado='E' and tu.revision_expirada=9999999999
        ) as plazas_longitud_E          
              

       , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  n.codprov=tu.codprov and n.codmunic=tu.codmunic and n.codentidad=tu.codentidad and n.codpoblamiento=tu.codpoblamiento and  tu.tipo='OT' and estado='B' and tu.revision_expirada=9999999999
         ) as otros_longitud_b
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  n.codprov=tu.codprov and n.codmunic=tu.codmunic and n.codentidad=tu.codentidad and n.codpoblamiento=tu.codpoblamiento and tu.tipo='OT' and estado='R' and tu.revision_expirada=9999999999
        ) as otros_longitud_r
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  n.codprov=tu.codprov and n.codmunic=tu.codmunic and n.codentidad=tu.codentidad and n.codpoblamiento=tu.codpoblamiento and  tu.tipo='OT' and estado='M' and tu.revision_expirada=9999999999
        ) as otros_longitud_m     
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  n.codprov=tu.codprov and n.codmunic=tu.codmunic and n.codentidad=tu.codentidad and n.codpoblamiento=tu.codpoblamiento and tu.tipo='OT' and estado='R' and tu.revision_expirada=9999999999
        ) as otros_longitud_NP
        , ( SELECT SUM(longitud) FROM eiel_c_redviaria_tu tu where  n.codprov=tu.codprov and n.codmunic=tu.codmunic and n.codentidad=tu.codentidad and n.codpoblamiento=tu.codpoblamiento and  tu.tipo='OT' and estado='M' and tu.revision_expirada=9999999999
        ) as otros_longitud_E              

FROM 
     eiel_c_nucleo_poblacion n    
WHERE n.codprov='?p' and n.codmunic='?m' 
      --and n.revision_expirada=9999999999
GROUP BY 1,2,3,4,5,6,7
ORDER BY 2,3,4,5,6;
</entry>

<entry key="indicadores_eiel_iii_alumbrado_mun">
INSERT INTO eiel_indicadores_d_alumbrado(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, 
            codpoblamiento, 
            potenciaPuntosLuz,
            npuntosluz_ahorro_rlf,
            npuntosluz_estado_b, npuntosluz_estado_r, npuntosluz_estado_m)

SELECT 
        m."GEOMETRY" as "GEOMETRY", m.id as id_municipio, m.nombreoficial
       ,m.id_provincia, m.id_ine,  null as codentidad, null as codpoblamiento

       , ( SELECT SUM(potencia)/1000 FROM eiel_c_alum_pl pl where  m.id_provincia=pl.codprov and m.id_ine=pl.codmunic    --pl.revision_expirada=9999999999
        ) as potenciaPuntosLuz
       , ( SELECT COUNT(1) FROM eiel_c_alum_pl pl where  m.id_provincia=pl.codprov and m.id_ine=pl.codmunic  and    ah_ener_rfl='SI'  --pl.revision_expirada=9999999999
        ) as npuntosluz_ahorro_rlf        
       , ( SELECT COUNT(1) FROM eiel_c_alum_pl pl where  m.id_provincia=pl.codprov and m.id_ine=pl.codmunic  and    estado='B'  --pl.revision_expirada=9999999999
        ) as npuntosluz_estado_b
       , ( SELECT COUNT(1) FROM eiel_c_alum_pl pl where  m.id_provincia=pl.codprov and m.id_ine=pl.codmunic  and    estado='R'  --pl.revision_expirada=9999999999
        ) as npuntosluz_estado_r
       , ( SELECT COUNT(1) FROM eiel_c_alum_pl pl where  m.id_provincia=pl.codprov and m.id_ine=pl.codmunic  and    estado='M'  --pl.revision_expirada=9999999999
        ) as npuntosluz_estado_m
FROM 
     municipios m    

WHERE
 m.id=?M and srid(m."GEOMETRY")=4230
GROUP BY 1,2,3,4,5,6,7
ORDER BY 2,3,4,5,6;

</entry>

<entry key="eiel_indicadores_iii_alumbrado_nuc">

INSERT INTO eiel_indicadores_d_alumbrado(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, 
            codpoblamiento, 
            potenciaPuntosLuz,
            npuntosluz_ahorro_rlf,
            npuntosluz_estado_b, npuntosluz_estado_r, npuntosluz_estado_m)
SELECT 
        n."GEOMETRY" as "GEOMETRY", (n.codprov || n.codmunic) as id_municipio, n.nombre_oficial
       ,n.codprov, n.codmunic,  n.codentidad, n.codpoblamiento

       , ( SELECT SUM(potencia)/1000 FROM eiel_c_alum_pl pl where  n.codprov=pl.codprov and n.codmunic=pl.codmunic and n.codentidad=pl.codentidad and n.codpoblamiento=pl.codpoblamiento   --pl.revision_expirada=9999999999
        ) as potenciaPuntosLuz
       , ( SELECT COUNT(1) FROM eiel_c_alum_pl pl where  n.codprov=pl.codprov and n.codmunic=pl.codmunic and n.codentidad=pl.codentidad and n.codpoblamiento=pl.codpoblamiento and    ah_ener_rfl='SI'  --pl.revision_expirada=9999999999
        ) as npuntosluz_ahorro_rlf        
       , ( SELECT COUNT(1) FROM eiel_c_alum_pl pl where  n.codprov=pl.codprov and n.codmunic=pl.codmunic  and n.codentidad=pl.codentidad and n.codpoblamiento=pl.codpoblamiento and    estado='B'  --pl.revision_expirada=9999999999
        ) as npuntosluz_estado_b
       , ( SELECT COUNT(1) FROM eiel_c_alum_pl pl where  n.codprov=pl.codprov and n.codmunic=pl.codmunic  and n.codentidad=pl.codentidad and n.codpoblamiento=pl.codpoblamiento and    estado='R'  --pl.revision_expirada=9999999999
        ) as npuntosluz_estado_r
       , ( SELECT COUNT(1) FROM eiel_c_alum_pl pl where  n.codprov=pl.codprov and n.codmunic=pl.codmunic  and n.codentidad=pl.codentidad and n.codpoblamiento=pl.codpoblamiento and    estado='M'  --pl.revision_expirada=9999999999 
        ) as npuntosluz_estado_m    

FROM 
     eiel_c_nucleo_poblacion n    
WHERE n.codprov='?p' and n.codmunic='?m' 
      --and n.revision_expirada=9999999999

GROUP BY 1,2,3,4,5,6,7
ORDER BY 2,3,4,5,6;
</entry>

<entry key="eiel_indicadores_iii_comunicaciones_pre">
INSERT INTO eiel_indicadores_d_comunicaciones_aux(
            "GEOMETRY", id_municipio, nombre_oficial, codprov, codmunic, 
            codentidad, codpoblamiento, 
            tv_ant, tv_ca, 
            tm_gsm, tm_umts, tm_gprs, 
            internet_ba,
            electric, gas, 
            habitantes, pobestacional)
SELECT 
       n."GEOMETRY", id_municipio, n.nombre_oficial
       ,ne.codprov, ne.codmunic, ne.codentidad, ne.codpoblamiento

       ,tv_ant, tv_ca, tm_gsm, tm_umts, tm_gprs
       , (CASE 
            WHEN (ba_xd='SI' or ba_wi='SI' or ba_ca='SI' or ba_rd='SI') THEN 'S'
            ELSE 'N'
           END ) as internet_ba       
       , electric, gas
       ,ne.padron as habitantes
       ,ne.pob_estacional as pobEstacional
FROM 
     eiel_c_nucleo_poblacion n 
      ,
     eiel_t_nucl_encuest_1 ne        
      , eiel_t_inf_ttmm tinf

where    n.codprov='?p' and n.codmunic='?m' and 
       ( n.codprov=ne.codprov and n.codmunic=ne.codmunic and n.codentidad=ne.codentidad and n.codpoblamiento=ne.codpoblamiento) and 
       (n.codprov=tinf.codprov and n.codmunic=tinf.codmunic and n.codentidad=tinf.codentidad and n.codpoblamiento=tinf.codpoblamiento) 
        and ne.revision_expirada=9999999999
        --and n.revision_expirada=9999999999

ORDER BY 2,4,5,6,7;
</entry>

<entry key="eiel_indicadores_iii_comunicaciones_mun">
INSERT INTO eiel_indicadores_d_comunicaciones(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, codpoblamiento, 
            nnuc_serv_telefono, nhab_serv_telefono, nest_serv_telefono, 
            nnuc_serv_telefono_no, nhab_serv_telefono_no, nest_serv_telefono_no, 
            nnuc_tv_b, nhab_tv_b, nest_tv_b, 
            nnuc_tv_r, nhab_tv_r, nest_tv_r, 
            nnuc_tv_m, nhab_tv_m, nest_tv_m,
            nnuc_tv_n, nhab_tv_n, nest_tv_n,
            nnuc_internet_ba_s)

SELECT 
       m."GEOMETRY",
        (n.codprov||n.codmunic) as idmunicipio,m.nombreoficial
         ,n.codprov, n.codmunic, null, null

       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE tm_gsm in ('B','R','M') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nnuc_serv_telefono
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE tm_gsm in ('B','R','M') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nhab_serv_telefono
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE tm_gsm in ('B','R','M') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nest_serv_telefono

       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE tm_gsm in ('C') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nnuc_serv_telefono_no
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE tm_gsm in ('C') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nhab_serv_telefono_no
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE tm_gsm in ('C') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nest_serv_telefono_no

       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE tv_ant in ('B') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nnuc_tv_b
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE tv_ant in ('B') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nhab_tv_b
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE tv_ant in ('B') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nest_tv_b

       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE tv_ant in ('R') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nnuc_tv_r
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE tv_ant in ('R') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nhab_tv_r
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE tv_ant in ('R') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nest_tv_r

       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE tv_ant in ('M') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nnuc_tv_m
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE tv_ant in ('M') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nhab_tv_m
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE tv_ant in ('M') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nest_tv_m

       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE tv_ant in ('N') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nnuc_tv_n
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE tv_ant in ('N') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nhab_tv_n
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE tv_ant in ('N') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nest_tv_n
       
       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE internet_ba='S' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nnuc_tv_n       


FROM  municipios m, eiel_c_nucleo_poblacion n 
WHERE m.id=?M and  n.codprov=m.id_provincia and n.codmunic=m.id_ine  and srid(m."GEOMETRY")=4230 
      --and n.revision_expirada=9999999999
GROUP BY 1,2,3,4,5,6
ORDER by 2,3,4,5,6;

</entry>
<entry key="eiel_indicadores_iii_comunicaciones_nuc">
INSERT INTO eiel_indicadores_d_comunicaciones(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, codpoblamiento, 
            nnuc_serv_telefono, nhab_serv_telefono, nest_serv_telefono, 
            nnuc_serv_telefono_no, nhab_serv_telefono_no, nest_serv_telefono_no, 
            nnuc_tv_b, nhab_tv_b, nest_tv_b, 
            nnuc_tv_r, nhab_tv_r, nest_tv_r, 
            nnuc_tv_m, nhab_tv_m, nest_tv_m,
            nnuc_tv_n, nhab_tv_n, nest_tv_n, 
            nnuc_internet_ba_s)

SELECT 
        n."GEOMETRY", (n.codprov||n.codmunic) as idmunicipio,n.nombre_oficial,
         n.codprov, n.codmunic, n.codentidad, n.codpoblamiento

       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE tm_gsm in ('B','R','M') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nnuc_serv_telefono
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE tm_gsm in ('B','R','M') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nhab_serv_telefono
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE tm_gsm in ('B','R','M') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nest_serv_telefono

       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE tm_gsm in ('C') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nnuc_serv_telefono_no
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE tm_gsm in ('C') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nhab_serv_telefono_no
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE tm_gsm in ('C') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nest_serv_telefono_no

       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE tv_ant in ('B') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nnuc_tv_b
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE tv_ant in ('B') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nhab_tv_b
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE tv_ant in ('B') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nest_tv_b

       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE tv_ant in ('R') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nnuc_tv_r
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE tv_ant in ('R') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nhab_tv_r
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE tv_ant in ('R') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nest_tv_r

       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE tv_ant in ('M') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nnuc_tv_m
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE tv_ant in ('M') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nhab_tv_m
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE tv_ant in ('M') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nest_tv_m

       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE tv_ant in ('N') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nnuc_tv_n
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE tv_ant in ('N') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nhab_tv_n
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE tv_ant in ('N') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nest_tv_n
       
       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE internet_ba='S' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nest_tv_n

FROM  eiel_c_nucleo_poblacion n 
WHERE n.codprov='?p' and n.codmunic='?m' 
      --and n.revision_expirada=9999999999
ORDER by 2,3,4,5,6,7;

</entry>

<entry key="eiel_indicadores_iii_suministros_mun">
INSERT INTO eiel_indicadores_d_suministros(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, codpoblamiento, 
            nnuc_serv_elec_b, nhab_serv_elec_b, nest_serv_elec_b, 
            nnuc_serv_elec_r, nhab_serv_elec_r, nest_serv_elect_r, 
            nnuc_serv_elec_m, nhab_serv_elec_m, nest_serv_elec_m, 
            nnuc_serv_elec_n, nhab_serv_elec_n, nest_serv_elec_n, 
            
            nnuc_serv_gas_b, nhab_serv_gas_b, nest_serv_gas_b, 
            nnuc_serv_gas_r, nhab_serv_gas_r, nest_serv_gas_r, 
            nnuc_serv_gas_m, nhab_serv_gas_m, nest_serv_gas_m, 
            nnuc_serv_gas_n, nhab_serv_gas_n, nest_serv_gas_n)

SELECT 
       m."GEOMETRY",
        (n.codprov||n.codmunic) as idmunicipio,m.nombreoficial
         ,n.codprov, n.codmunic, null, null

       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE electric='B' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nnuc_serv_elec_b
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE electric='B' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nhab_serv_elec_b
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE electric='B' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nest_serv_elec_b

       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE electric='R' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nnuc_serv_elec_r
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE electric='R' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nhab_serv_elec_r
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE electric='R' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nest_serv_elec_r


       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE electric='M' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nnuc_serv_elec_m
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE electric='M' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nhab_serv_elec_m
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE electric='M' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nest_serv_elec_m

       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE electric='N' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nnuc_serv_elec_n
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE electric='N' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nhab_serv_elec_n
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE electric='N' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nest_serv_elec_n

       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE gas='B' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nnuc_serv_gas_b
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE gas='B' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nhab_serv_gas_b
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE gas='B' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nest_serv_gas_b

       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE gas='R' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nnuc_serv_gas_r
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE gas='R' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nhab_serv_gas_r
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE gas='R' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nest_serv_gas_r


       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE gas='M' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nnuc_serv_gas_m
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE gas='M' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nhab_serv_gas_m
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE gas='M' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nest_serv_gas_m

       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE gas='N' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nnuc_serv_gas_n
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE gas='N' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nhab_serv_gas_n
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE gas='N' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nest_serv_gas_n


FROM  municipios m, eiel_c_nucleo_poblacion n 
WHERE m.id=?M and  n.codprov=m.id_provincia and n.codmunic=m.id_ine  and srid(m."GEOMETRY")=4230
      --and n.revision_expirada=9999999999 
GROUP BY 1,2,3,4,5,6
ORDER by 2,3,4,5,6;

</entry>
<entry key="eiel_indicadores_iii_suministros_nuc">
INSERT INTO eiel_indicadores_d_suministros(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, 
            codpoblamiento, nnuc_serv_elec_b, nhab_serv_elec_b, nest_serv_elec_b, 
            nnuc_serv_elec_r, nhab_serv_elec_r, nest_serv_elect_r, nnuc_serv_elec_m, 
            nhab_serv_elec_m, nest_serv_elec_m, nnuc_serv_elec_n, nhab_serv_elec_n, 
            nest_serv_elec_n, nnuc_serv_gas_b, nhab_serv_gas_b, nest_serv_gas_b, 
            nnuc_serv_gas_r, nhab_serv_gas_r, nest_serv_gas_r, nnuc_serv_gas_m, 
            nhab_serv_gas_m, nest_serv_gas_m, nnuc_serv_gas_n, nhab_serv_gas_n, 
            nest_serv_gas_n)

SELECT 
        n."GEOMETRY", (n.codprov||n.codmunic) as idmunicipio,n.nombre_oficial,
         n.codprov, n.codmunic, n.codentidad, n.codpoblamiento

       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE electric='B' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nnuc_serv_elec_b
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE electric='B' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nhab_serv_elec_b
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE electric='B' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nest_serv_elec_b

       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE electric='R' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nnuc_serv_elec_r
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE electric='R' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nhab_serv_elec_r
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE electric='R' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nest_serv_elec_r


       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE electric='M' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nnuc_serv_elec_m
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE electric='M' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nhab_serv_elec_m
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE electric='M' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nest_serv_elec_m

       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE electric='N' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nnuc_serv_elec_n
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE electric='N' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nhab_serv_elec_n
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE electric='N' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nest_serv_elec_n

       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE gas='B' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nnuc_serv_gas_b
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE gas='B' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nhab_serv_gas_b
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE gas='B' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nest_serv_gas_b

       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE gas='R' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nnuc_serv_gas_r
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE gas='R' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nhab_serv_gas_r
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE gas='R' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nest_serv_gas_r


       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE gas='M' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nnuc_serv_gas_m
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE gas='M' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nhab_serv_gas_m
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE gas='M' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nest_serv_gas_m

       ,(SELECT COUNT(*) from eiel_indicadores_d_comunicaciones_aux t WHERE gas='N' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nnuc_serv_gas_n
       ,(SELECT SUM(habitantes) from eiel_indicadores_d_comunicaciones_aux t WHERE gas='N' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nhab_serv_gas_n
       ,(SELECT SUM(pobestacional) from eiel_indicadores_d_comunicaciones_aux t WHERE gas='N' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nest_serv_gas_n

FROM  eiel_c_nucleo_poblacion n 
WHERE n.codprov='?p' and n.codmunic='?m' 
      --and n.revision_expirada=9999999999
ORDER by 2,3,4,5,6,7;
</entry>

<entry key="eiel_indicadores_iv_rblimpieza_pre">
INSERT INTO eiel_indicadores_t_rblimpieza_aux(
            "GEOMETRY", id_municipio, nombre_oficial, codprov, codmunic, codentidad, codpoblamiento, 
            serv_limp_calles, 
            srb_viviendas_afec, srb_pob_res_afect, srb_pob_est_afect, 
            tipo, periodicidad, calidad, 
            n_contenedores,
            habitantes, pobestacional)

SELECT DISTINCT
       n."GEOMETRY", 
       id_municipio, n.nombre_oficial
       ,ne.codprov, ne.codmunic, ne.codentidad, ne.codpoblamiento

       ,rbserv.serv_limp_calles 
       ,rbserv.srb_viviendas_afec 
       ,rbserv.srb_pob_res_afect 
       ,rbserv.srb_pob_est_afect 
       ,rb.tipo 
       ,rb.periodicidad 
       ,rb.calidad
       ,rb.n_contenedores
       ,ne.padron as habitantes
       ,ne.pob_estacional as pobEstacional
       


FROM 
     eiel_c_nucleo_poblacion n 
      JOIN  eiel_t_nucl_encuest_1 ne  ON  ( n.codprov=ne.codprov and n.codmunic=ne.codmunic and n.codentidad=ne.codentidad and n.codpoblamiento=ne.codpoblamiento and ne.revision_expirada=9999999999)
      JOIN  eiel_t_rb_serv rbserv     ON  (n.codprov=rbserv.codprov and n.codmunic=rbserv.codmunic and n.codentidad=rbserv.codentidad and n.codpoblamiento=rbserv.codpoblamiento and rbserv.revision_expirada=9999999999) 
      JOIN  eiel_t_rb rb              ON  (n.codprov=rb.codprov     and n.codmunic=rb.codmunic     and n.codentidad=rb.codentidad     and n.codpoblamiento=rb.codpoblamiento and rb.revision_expirada=9999999999)

WHERE n.codprov='?p' and n.codmunic='?m' 
      --and n.revision_expirada=9999999999
      
      
ORDER BY 2,4,5,6,7;   
</entry>
<entry key="eiel_indicadores_iv_rblimpieza_mun">
INSERT INTO eiel_indicadores_d_rblimpieza(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, codpoblamiento, 
            nnuc_rbl_no, nhab_rbl_no, nest_rbl_no, 
            nnuc_rbl_period_me,   nhab_rbl_period_me,   nest_rble_period_me, 
            nnuc_rbl_period_ba,   nhab_rbl_period_ba,   nest_rbl_period_ba, 
            nnuc_rbl_calidad_ad,  nhab_rbl_calidad_ad,  nest_rbl_calidad_ad, 
            nnuc_rbl_calidad_in,  nhab_rbl_calidad_in,  nest_rbl_calidad_in, 
            nnuc_rb_selectiva_si, nhab_rb_selectiva_si, nest_rb_selectiva_si, 
            nnuc_rb_selectiva_no, nhab_rb_selectiva_no, nest_rb_selectiva_no, 
            nnuc_limp_si, nhab_limp_si, nest_limp_si, 
            nnuc_limp_no, nhab_limp_no, nest_limp_no, 
            n_contenedores,
            nviv_serv_deficit, nhab_serv_deficit, nest_serv_deficit,
            nnuc_rbl_period_a,   nhab_rbl_period_a,   nest_rbl_period_a)

SELECT 
       m."GEOMETRY",
        (n.codprov||n.codmunic) as idmunicipio,m.nombreoficial
         ,n.codprov, n.codmunic, null, null

       
       ,-1
       ,-1
       ,-1

       ,(SELECT COUNT(*) from eiel_indicadores_t_rblimpieza_aux t WHERE t.periodicidad IN ('SE','QU') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nnuc_rbl_period_me
       ,(SELECT SUM(habitantes) from eiel_indicadores_t_rblimpieza_aux t WHERE t.periodicidad IN ('SE','QU') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nhab_rbl_period_me
       ,(SELECT SUM(pobestacional) from eiel_indicadores_t_rblimpieza_aux t WHERE t.periodicidad IN ('SE','QU') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nest_rble_period_me

       ,(SELECT COUNT(*) from eiel_indicadores_t_rblimpieza_aux t WHERE t.periodicidad IN ('ME') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nnuc_rbl_period_ba
       ,(SELECT SUM(habitantes) from eiel_indicadores_t_rblimpieza_aux t WHERE t.periodicidad IN ('ME') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nhab_rbl_period_ba
       ,(SELECT SUM(pobestacional) from eiel_indicadores_t_rblimpieza_aux t WHERE t.periodicidad IN ('ME') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nest_rble_period_ba

       ,(SELECT COUNT(*) from eiel_indicadores_t_rblimpieza_aux t WHERE t.calidad IN ('AD') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nnuc_rbl_calidad_ad
       ,(SELECT SUM(habitantes) from eiel_indicadores_t_rblimpieza_aux t WHERE t.calidad IN ('AD') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nhab_rbl_calidad_ad
       ,(SELECT SUM(pobestacional) from eiel_indicadores_t_rblimpieza_aux t WHERE t.calidad IN ('AD') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nest_rbl_calidad_ad

       ,(SELECT COUNT(*) from eiel_indicadores_t_rblimpieza_aux t WHERE t.calidad IN ('IN') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nnuc_rbl_calidad_in
       ,(SELECT SUM(habitantes) from eiel_indicadores_t_rblimpieza_aux t WHERE t.calidad IN ('IN') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nhab_rbl_calidad_in
       ,(SELECT SUM(pobestacional) from eiel_indicadores_t_rblimpieza_aux t WHERE t.calidad IN ('IN') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nest_rbl_calidad_in

       ,(SELECT COUNT(*) from eiel_indicadores_t_rblimpieza_aux t WHERE t.tipo NOT IN ('RN') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nnuc_rbl_selectiva_si
       ,(SELECT SUM(habitantes) from eiel_indicadores_t_rblimpieza_aux t WHERE t.tipo NOT IN ('RN') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nhab_rbl_selectiva_si
       ,(SELECT SUM(pobestacional) from eiel_indicadores_t_rblimpieza_aux t WHERE t.tipo NOT IN ('RN') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nest_rbl_selectiva_si

       ,(SELECT COUNT(*) from eiel_indicadores_t_rblimpieza_aux t WHERE t.tipo  IN ('RN') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nnuc_rbl_selectiva_no
       ,(SELECT SUM(habitantes) from eiel_indicadores_t_rblimpieza_aux t WHERE t.tipo  IN ('RN') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nhab_rbl_selectiva_no
       ,(SELECT SUM(pobestacional) from eiel_indicadores_t_rblimpieza_aux t WHERE t.tipo  IN ('RN') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nest_rbl_selectiva_no

       
       ,(SELECT COUNT(*) from eiel_indicadores_t_rblimpieza_aux t WHERE t.serv_limp_calles='SI' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nnuc_limp_si
       ,(SELECT SUM(habitantes) from eiel_indicadores_t_rblimpieza_aux t WHERE t.serv_limp_calles='SI' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nhab_limp_si
       ,(SELECT SUM(pobestacional) from eiel_indicadores_t_rblimpieza_aux t WHERE t.serv_limp_calles='SI' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nest_limp_si

       ,(SELECT COUNT(*) from eiel_indicadores_t_rblimpieza_aux t WHERE t.serv_limp_calles='NO' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nnuc_limp_si
       ,(SELECT SUM(habitantes) from eiel_indicadores_t_rblimpieza_aux t WHERE t.serv_limp_calles='NO' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nhab_limp_si
       ,(SELECT SUM(pobestacional) from eiel_indicadores_t_rblimpieza_aux t WHERE t.serv_limp_calles='NO' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nest_limp_si

       ,(SELECT SUM(n_contenedores) from eiel_indicadores_t_rblimpieza_aux t WHERE n.codprov=t.codprov and n.codmunic=t.codmunic ) as n_contenedores

       ,(SELECT SUM(srb_viviendas_afec)  from eiel_indicadores_t_rblimpieza_aux t WHERE t.serv_limp_calles='NO' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as 
srb_viviendas_afec
       ,(SELECT SUM(srb_pob_res_afect) from eiel_indicadores_t_rblimpieza_aux t WHERE t.serv_limp_calles='NO' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nhab_serv_deficit
       ,(SELECT SUM(srb_pob_est_afect) from eiel_indicadores_t_rblimpieza_aux t WHERE t.serv_limp_calles='NO' and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nest_serv_deficit

       ,(SELECT COUNT(*) from eiel_indicadores_t_rblimpieza_aux t WHERE t.periodicidad IN ('DI') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nnuc_rbl_period_a
       ,(SELECT SUM(habitantes) from eiel_indicadores_t_rblimpieza_aux t WHERE t.periodicidad IN ('DI') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nhab_rbl_period_a
       ,(SELECT SUM(pobestacional) from eiel_indicadores_t_rblimpieza_aux t WHERE t.periodicidad IN ('DI') and n.codprov=t.codprov and n.codmunic=t.codmunic ) as nest_rbl_period_a


FROM  municipios m, eiel_c_nucleo_poblacion n 
WHERE m.id=?M and  n.codprov=m.id_provincia and n.codmunic=m.id_ine  and srid(m."GEOMETRY")=4230 
      --and n.revision_expirada=9999999999
GROUP BY 1,2,3,4,5,6
ORDER by 2,3,4,5,6;
</entry>
<entry key="eiel_indicadores_iv_rblimpieza_nuc">
INSERT INTO eiel_indicadores_d_rblimpieza(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, codpoblamiento, 
            nnuc_rbl_no, nhab_rbl_no, nest_rbl_no, 
            nnuc_rbl_period_me,   nhab_rbl_period_me,   nest_rble_period_me, 
            nnuc_rbl_period_ba,   nhab_rbl_period_ba,   nest_rbl_period_ba, 
            nnuc_rbl_calidad_ad,  nhab_rbl_calidad_ad,  nest_rbl_calidad_ad, 
            nnuc_rbl_calidad_in,  nhab_rbl_calidad_in,  nest_rbl_calidad_in, 
            nnuc_rb_selectiva_si, nhab_rb_selectiva_si, nest_rb_selectiva_si, 
            nnuc_rb_selectiva_no, nhab_rb_selectiva_no, nest_rb_selectiva_no, 
            nnuc_limp_si, nhab_limp_si, nest_limp_si, 
            nnuc_limp_no, nhab_limp_no, nest_limp_no, 
            n_contenedores,
            nviv_serv_deficit, nhab_serv_deficit, nest_serv_deficit,
            nnuc_rbl_period_a,   nhab_rbl_period_a,   nest_rbl_period_a)

SELECT 
        n."GEOMETRY", (n.codprov||n.codmunic) as idmunicipio,n.nombre_oficial,
         n.codprov, n.codmunic, n.codentidad, n.codpoblamiento

       
       ,(CASE WHEN (SELECT EXISTS (SELECT nombre_oficial FROM eiel_indicadores_t_rblimpieza_aux t WHERE  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento))=true THEN 0 ELSE 1 END) as nnuc_rbl_no
       ,-1
       ,-1

       ,(SELECT COUNT(*) from eiel_indicadores_t_rblimpieza_aux t WHERE t.periodicidad IN ('SE','QU') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as nnuc_rbl_period_me
       ,(SELECT SUM(habitantes) from eiel_indicadores_t_rblimpieza_aux t WHERE t.periodicidad IN ('SE','QU') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nhab_rbl_period_me
       ,(SELECT SUM(pobestacional) from eiel_indicadores_t_rblimpieza_aux t WHERE t.periodicidad IN ('SE','QU') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nest_rble_period_me

       ,(SELECT COUNT(*) from eiel_indicadores_t_rblimpieza_aux t WHERE t.periodicidad IN ('ME') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nnuc_rbl_period_ba
       ,(SELECT SUM(habitantes) from eiel_indicadores_t_rblimpieza_aux t WHERE t.periodicidad IN ('ME') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nhab_rbl_period_ba
       ,(SELECT SUM(pobestacional) from eiel_indicadores_t_rblimpieza_aux t WHERE t.periodicidad IN ('ME') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nest_rble_period_ba

       ,(SELECT COUNT(*) from eiel_indicadores_t_rblimpieza_aux t WHERE t.calidad IN ('AD') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nnuc_rbl_calidad_ad
       ,(SELECT SUM(habitantes) from eiel_indicadores_t_rblimpieza_aux t WHERE t.calidad IN ('AD') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nhab_rbl_calidad_ad
       ,(SELECT SUM(pobestacional) from eiel_indicadores_t_rblimpieza_aux t WHERE t.calidad IN ('AD') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nest_rbl_calidad_ad

       ,(SELECT COUNT(*) from eiel_indicadores_t_rblimpieza_aux t WHERE t.calidad IN ('IN') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nnuc_rbl_calidad_in
       ,(SELECT SUM(habitantes) from eiel_indicadores_t_rblimpieza_aux t WHERE t.calidad IN ('IN') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nhab_rbl_calidad_in
       ,(SELECT SUM(pobestacional) from eiel_indicadores_t_rblimpieza_aux t WHERE t.calidad IN ('IN') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nest_rbl_calidad_in

       ,(SELECT COUNT(*) from eiel_indicadores_t_rblimpieza_aux t WHERE t.tipo NOT IN ('RN') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nnuc_rbl_selectiva_si
       ,(SELECT SUM(habitantes) from eiel_indicadores_t_rblimpieza_aux t WHERE t.tipo NOT IN ('RN') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nhab_rbl_selectiva_si
       ,(SELECT SUM(pobestacional) from eiel_indicadores_t_rblimpieza_aux t WHERE t.tipo NOT IN ('RN') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nest_rbl_selectiva_si

       ,(SELECT COUNT(*) from eiel_indicadores_t_rblimpieza_aux t WHERE t.tipo  IN ('RN') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nnuc_rbl_selectiva_no
       ,(SELECT SUM(habitantes) from eiel_indicadores_t_rblimpieza_aux t WHERE t.tipo  IN ('RN') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nhab_rbl_selectiva_no
       ,(SELECT SUM(pobestacional) from eiel_indicadores_t_rblimpieza_aux t WHERE t.tipo  IN ('RN') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nest_rbl_selectiva_no

       
       ,(SELECT COUNT(*) from eiel_indicadores_t_rblimpieza_aux t WHERE t.serv_limp_calles='SI' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nnuc_limp_si
       ,(SELECT SUM(habitantes) from eiel_indicadores_t_rblimpieza_aux t WHERE t.serv_limp_calles='SI' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nhab_limp_si
       ,(SELECT SUM(pobestacional) from eiel_indicadores_t_rblimpieza_aux t WHERE t.serv_limp_calles='SI' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nest_limp_si

       ,(SELECT COUNT(*) from eiel_indicadores_t_rblimpieza_aux t WHERE t.serv_limp_calles='NO' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nnuc_limp_si
       ,(SELECT SUM(habitantes) from eiel_indicadores_t_rblimpieza_aux t WHERE t.serv_limp_calles='NO' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nhab_limp_si
       ,(SELECT SUM(pobestacional) from eiel_indicadores_t_rblimpieza_aux t WHERE t.serv_limp_calles='NO' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nest_limp_si

       ,(SELECT SUM(n_contenedores) from eiel_indicadores_t_rblimpieza_aux t WHERE n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento) as n_contenedores

       ,(SELECT SUM(srb_viviendas_afec)  from eiel_indicadores_t_rblimpieza_aux t WHERE t.serv_limp_calles='NO' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as 
srb_viviendas_afec
       ,(SELECT SUM(srb_pob_res_afect) from eiel_indicadores_t_rblimpieza_aux t WHERE t.serv_limp_calles='NO' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nhab_serv_deficit
       ,(SELECT SUM(srb_pob_est_afect) from eiel_indicadores_t_rblimpieza_aux t WHERE t.serv_limp_calles='NO' and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nest_serv_deficit

       ,(SELECT COUNT(*) from eiel_indicadores_t_rblimpieza_aux t WHERE t.periodicidad IN ('DI') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nnuc_rbl_period_a
       ,(SELECT SUM(habitantes) from eiel_indicadores_t_rblimpieza_aux t WHERE t.periodicidad IN ('DI') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nhab_rbl_period_a
       ,(SELECT SUM(pobestacional) from eiel_indicadores_t_rblimpieza_aux t WHERE t.periodicidad IN ('DI') and n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento ) as nest_rbl_period_a


FROM  eiel_c_nucleo_poblacion n
WHERE n.codprov='?p' and n.codmunic='?m' 
      --and n.revision_expirada=9999999999 
ORDER by 2,3,4,5,6,7;
</entry>

<entry key="eiel_indicadores_iv_tratamresiduos_mun"></entry>
<entry key="eiel_indicadores_iv_tratamresiduos_nuc"></entry>

<entry key="eiel_indicadores_v_centrosen_mun">
INSERT INTO eiel_indicadores_d_centrosen(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, codpoblamiento, 
            guarderia_ncen, guarderia_capacidad, 
            einfantil_ncen, einfantil_plazas, einfantil_nalumnos,
            primaria_ncen, primaria_plazas, primaria_nalumnos, 
            secundaria_ncen, secundaria_plazas, secundaria_nalumnos, 
            fp_ncen, fp_plazas, fp_nalumnos, 
            guarderia_sup_cubierta_b, guarderia_sup_cubierta_r, guarderia_sup_cubierta_m, 
            guarderia_sup_alibre_b, guarderia_sup_alibre_r, guarderia_sup_alibre_m)

SELECT 
        m."GEOMETRY" as "GEOMETRY", m.id as id_municipio, m.nombreoficial
       ,m.id_provincia, m.id_ine,  null as codentidad, null as codpoblamiento

       , ( SELECT COUNT(*) FROM eiel_t_as t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.tipo='GI' and t.revision_expirada=9999999999) as guarderia_ncen
       , ( SELECT SUM(t.plazas) FROM eiel_t_as t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic  and t.tipo='GI' and t.revision_expirada=9999999999) as guarderia_capacidad

       , ( SELECT COUNT(*) FROM eiel_t_en_nivel as t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.nivel='INF' and t.revision_expirada=9999999999) as einfantil_ncen
       , ( SELECT SUM(plazas) FROM eiel_t_en_nivel as t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.nivel='INF' and t.revision_expirada=9999999999) as einfantil_ncen
       , ( SELECT SUM(alumnos) FROM eiel_t_en_nivel as t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.nivel='INF' and t.revision_expirada=9999999999) as einfantil_nalumnos    

       , ( SELECT COUNT(*) FROM eiel_t_en_nivel as t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.nivel='PRI' and t.revision_expirada=9999999999) as primaria_ncen
       , ( SELECT SUM(plazas) FROM eiel_t_en_nivel as t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.nivel='PRI' and t.revision_expirada=9999999999) as primaria_plazas
       , ( SELECT SUM(alumnos) FROM eiel_t_en_nivel as t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.nivel='PRI' and t.revision_expirada=9999999999) as primaria_nalumnos  

       , ( SELECT COUNT(*) FROM eiel_t_en_nivel as t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.nivel='BAC' and t.revision_expirada=9999999999) as secundaria_ncen
       , ( SELECT SUM(plazas) FROM eiel_t_en_nivel as t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.nivel='BAC' and t.revision_expirada=9999999999) as secundaria_plazas
       , ( SELECT SUM(alumnos) FROM eiel_t_en_nivel as t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.nivel='BAC' and t.revision_expirada=9999999999) as secundaria_nalumnos      

       , ( SELECT COUNT(*) FROM eiel_t_en_nivel as t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.nivel='FP' and t.revision_expirada=9999999999) as fp_ncen
       , ( SELECT SUM(plazas) FROM eiel_t_en_nivel as t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.nivel='FP' and t.revision_expirada=9999999999) as fp_plazas
       , ( SELECT SUM(alumnos) FROM eiel_t_en_nivel as t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.nivel='FP' and t.revision_expirada=9999999999) as fp_nalumnos     

       , ( SELECT SUM(t.s_cubierta) FROM eiel_t_as t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic  and t.tipo='GI' and t.estado='B' and t.revision_expirada=9999999999) as guarderia_sup_cubierta_b   
       , ( SELECT SUM(t.s_cubierta) FROM eiel_t_as t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic  and t.tipo='GI' and t.estado='R' and t.revision_expirada=9999999999) as guarderia_sup_cubierta_r     
       , ( SELECT SUM(t.s_cubierta) FROM eiel_t_as t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic  and t.tipo='GI' and t.estado='M' and t.revision_expirada=9999999999) as guarderia_sup_cubierta_m     

       , ( SELECT SUM(t.s_aire) FROM eiel_t_as t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic  and t.tipo='GI' and t.estado='B' and t.revision_expirada=9999999999) as guarderia_sup_alibre_b   
       , ( SELECT SUM(t.s_aire) FROM eiel_t_as t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic  and t.tipo='GI' and t.estado='R' and t.revision_expirada=9999999999) as guarderia_sup_alibre_r     
       , ( SELECT SUM(t.s_aire) FROM eiel_t_as t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic  and t.tipo='GI' and t.estado='M' and t.revision_expirada=9999999999) as guarderia_sup_alibrea_m       
FROM 
     municipios m    
WHERE
   m.id=?M and srid(m."GEOMETRY")=4230
GROUP BY 1,2,3,4,5,6,7
ORDER BY 2,3,4,5,6;


</entry>
<entry key="eiel_indicadores_v_centrosen_nuc">

INSERT INTO eiel_indicadores_d_centrosen(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, codpoblamiento, 
            guarderia_ncen, guarderia_capacidad, 
            einfantil_ncen, einfantil_plazas, einfantil_nalumnos,
            primaria_ncen, primaria_plazas, primaria_nalumnos, 
            secundaria_ncen, secundaria_plazas, secundaria_nalumnos, 
            fp_ncen, fp_plazas, fp_nalumnos, 
            guarderia_sup_cubierta_b, guarderia_sup_cubierta_r, guarderia_sup_cubierta_m, 
            guarderia_sup_alibre_b, guarderia_sup_alibre_r, guarderia_sup_alibre_m)

SELECT 
        n."GEOMETRY" as "GEOMETRY", (n.codprov || n.codmunic) as id_municipio, n.nombre_oficial
       ,n.codprov, n.codmunic,  n.codentidad, n.codpoblamiento

       , ( SELECT COUNT(*) FROM eiel_t_as t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.tipo='GI' and t.revision_expirada=9999999999) as guarderia_ncen
       , ( SELECT SUM(t.plazas) FROM eiel_t_as t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento  and t.tipo='GI' and t.revision_expirada=9999999999) as guarderia_capacidad

       , ( SELECT COUNT(*) FROM eiel_t_en_nivel as t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.nivel='INF' and t.revision_expirada=9999999999) as einfantil_ncen
       , ( SELECT SUM(plazas) FROM eiel_t_en_nivel as t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.nivel='INF' and t.revision_expirada=9999999999) as einfantil_ncen
       , ( SELECT SUM(alumnos) FROM eiel_t_en_nivel as t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.nivel='INF' and t.revision_expirada=9999999999) as einfantil_nalumnos    

       , ( SELECT COUNT(*) FROM eiel_t_en_nivel as t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.nivel='PRI' and t.revision_expirada=9999999999) as primaria_ncen
       , ( SELECT SUM(plazas) FROM eiel_t_en_nivel as t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.nivel='PRI' and t.revision_expirada=9999999999) as primaria_plazas
       , ( SELECT SUM(alumnos) FROM eiel_t_en_nivel as t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.nivel='PRI' and t.revision_expirada=9999999999) as primaria_nalumnos  

       , ( SELECT COUNT(*) FROM eiel_t_en_nivel as t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.nivel='BAC' and t.revision_expirada=9999999999) as secundaria_ncen
       , ( SELECT SUM(plazas) FROM eiel_t_en_nivel as t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.nivel='BAC' and t.revision_expirada=9999999999) as secundaria_plazas
       , ( SELECT SUM(alumnos) FROM eiel_t_en_nivel as t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.nivel='BAC' and t.revision_expirada=9999999999) as secundaria_nalumnos      

       , ( SELECT COUNT(*) FROM eiel_t_en_nivel as t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.nivel='FP' and t.revision_expirada=9999999999) as fp_ncen
       , ( SELECT SUM(plazas) FROM eiel_t_en_nivel as t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.nivel='FP' and t.revision_expirada=9999999999) as fp_plazas
       , ( SELECT SUM(alumnos) FROM eiel_t_en_nivel as t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.nivel='FP' and t.revision_expirada=9999999999) as fp_nalumnos     

       , ( SELECT SUM(t.s_cubierta) FROM eiel_t_as t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento  and t.tipo='GI' and t.estado='B' and t.revision_expirada=9999999999) as guarderia_sup_cubierta_b   
       , ( SELECT SUM(t.s_cubierta) FROM eiel_t_as t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento  and t.tipo='GI' and t.estado='R' and t.revision_expirada=9999999999) as guarderia_sup_cubierta_r     
       , ( SELECT SUM(t.s_cubierta) FROM eiel_t_as t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento  and t.tipo='GI' and t.estado='M' and t.revision_expirada=9999999999) as guarderia_sup_cubierta_m     

       , ( SELECT SUM(t.s_aire) FROM eiel_t_as t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento  and t.tipo='GI' and t.estado='B' and t.revision_expirada=9999999999) as guarderia_sup_alibre_b   
       , ( SELECT SUM(t.s_aire) FROM eiel_t_as t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento  and t.tipo='GI' and t.estado='R' and t.revision_expirada=9999999999) as guarderia_sup_alibre_r     
       , ( SELECT SUM(t.s_aire) FROM eiel_t_as t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento  and t.tipo='GI' and t.estado='M' and t.revision_expirada=9999999999) as guarderia_sup_alibrea_m    

FROM 
     eiel_c_nucleo_poblacion n    

WHERE n.codprov='?p' and n.codmunic='?m' 
      --and n.revision_expirada=9999999999
GROUP BY 1,2,3,4,5,6,7
ORDER BY 2,3,4,5,6;
</entry>

<entry key="eiel_indicadores_v_ideporte_mun">
INSERT INTO eiel_indicadores_d_ideporte(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, codpoblamiento, 
            npolideportiv, npolideportiv_alibre, npiscinas, 
            sup_alibre_b, sup_alibre_r, sup_alibre_m)

SELECT 
        m."GEOMETRY" as "GEOMETRY", m.id as id_municipio, m.nombreoficial
       ,m.id_provincia, m.id_ine,  null as codentidad, null as codpoblamiento

       , ( SELECT COUNT(*) FROM eiel_t_id t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.tipo='PP' and t.revision_expirada=9999999999) as npolideportiv
       , ( SELECT COUNT(*) FROM eiel_t_id t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.tipo='PP' and t.s_aire>0 and t.revision_expirada=9999999999) as npolideportiv_alibre       
       , ( SELECT COUNT(*) FROM eiel_t_id t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.tipo='PI' and t.revision_expirada=9999999999) as npiscinas

       , ( SELECT SUM(s_aire) FROM eiel_t_id t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.estado='B' and t.s_aire>0 and t.revision_expirada=9999999999) as sup_alibre_b 
       , ( SELECT SUM(s_aire) FROM eiel_t_id t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.estado='R' and t.s_aire>0 and t.revision_expirada=9999999999) as sup_alibre_r
       , ( SELECT SUM(s_aire) FROM eiel_t_id t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.estado='M' and t.s_aire>0 and t.revision_expirada=9999999999) as sup_alibre_m 


FROM 
     municipios m    
WHERE
  m.id=?M and srid(m."GEOMETRY")=4230
GROUP BY 1,2,3,4,5,6,7
ORDER BY 2,3,4,5,6;
</entry>
<entry key="eiel_indicadores_v_ideporte_nuc">

INSERT INTO eiel_indicadores_d_ideporte(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, codpoblamiento, 
            npolideportiv, npolideportiv_alibre, npiscinas, 
            sup_alibre_b, sup_alibre_r, sup_alibre_m)

SELECT 
        n."GEOMETRY" as "GEOMETRY", (n.codprov || n.codmunic) as id_municipio, n.nombre_oficial
       ,n.codprov, n.codmunic,  n.codentidad, n.codpoblamiento  

       , ( SELECT COUNT(*) FROM eiel_t_id t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.tipo='PP' and t.revision_expirada=9999999999) as npolideportiv
       , ( SELECT COUNT(*) FROM eiel_t_id t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.tipo='PP' and t.s_aire>0 and t.revision_expirada=9999999999) as npolideportiv_alibre       
       , ( SELECT COUNT(*) FROM eiel_t_id t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.tipo='PI' and t.revision_expirada=9999999999) as npiscinas

       , ( SELECT SUM(s_aire) FROM eiel_t_id t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.estado='B' and t.s_aire>0 and t.revision_expirada=9999999999) as sup_alibre_b 
       , ( SELECT SUM(s_aire) FROM eiel_t_id t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.estado='R' and t.s_aire>0 and t.revision_expirada=9999999999) as sup_alibre_r
       , ( SELECT SUM(s_aire) FROM eiel_t_id t where n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.estado='M' and t.s_aire>0 and t.revision_expirada=9999999999) as sup_alibre_m 
FROM 
     eiel_c_nucleo_poblacion n    

WHERE n.codprov='?p' and n.codmunic='?m' 
      --and n.revision_expirada=9999999999
GROUP BY 1,2,3,4,5,6,7
ORDER BY 2,3,4,5,6;
</entry>

<entry key="eiel_indicadores_v_ccultura_mun">
INSERT INTO eiel_indicadores_d_ccultura(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, codpoblamiento, 
            nbibliotecas, nteatroscinesaudit, 
            sup_ccultura_b, sup_ccultura_r, sup_ccultura_m)

SELECT 
        m."GEOMETRY" as "GEOMETRY", m.id as id_municipio, m.nombreoficial
       ,m.id_provincia, m.id_ine,  null as codentidad, null as codpoblamiento

       , ( SELECT COUNT(*) FROM eiel_t_cu_usos t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.uso='BA' and t.revision_expirada=9999999999) as nbibliotecas
       , ( SELECT COUNT(*) FROM eiel_t_cu_usos t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.uso IN ('AA','CI') and t.revision_expirada=9999999999) as nteatroscinesaudit

       , ( SELECT SUM(s_cubierta) FROM eiel_t_cu t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.estado='B' and t.revision_expirada=9999999999) as sup_alibre_b 
       , ( SELECT SUM(s_cubierta) FROM eiel_t_cu t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.estado='R' and t.revision_expirada=9999999999) as sup_alibre_r
       , ( SELECT SUM(s_cubierta) FROM eiel_t_cu t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.estado='M' and t.revision_expirada=9999999999) as sup_alibre_m 


FROM 
     municipios m    
WHERE
 m.id=?M and srid(m."GEOMETRY")=4230
GROUP BY 1,2,3,4,5,6,7
ORDER BY 2,3,4,5,6;
</entry>
<entry key="eiel_indicadores_v_ccultura_nuc">

INSERT INTO eiel_indicadores_d_ccultura(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, codpoblamiento, 
            nbibliotecas, nteatroscinesaudit, 
            sup_ccultura_b, sup_ccultura_r, sup_ccultura_m)

SELECT 
        n."GEOMETRY" as "GEOMETRY", (n.codprov || n.codmunic) as id_municipio, n.nombre_oficial
       ,n.codprov, n.codmunic,  n.codentidad, n.codpoblamiento

       , ( SELECT COUNT(*) FROM eiel_t_cu_usos t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.uso='BA' and t.revision_expirada=9999999999) as nbibliotecas
       , ( SELECT COUNT(*) FROM eiel_t_cu_usos t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.uso IN ('AA','CI') and t.revision_expirada=9999999999) as nteatroscinesaudit

       , ( SELECT SUM(s_cubierta) FROM eiel_t_cu t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.estado='B' and t.revision_expirada=9999999999) as sup_alibre_b 
       , ( SELECT SUM(s_cubierta) FROM eiel_t_cu t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.estado='R' and t.revision_expirada=9999999999) as sup_alibre_r
       , ( SELECT SUM(s_cubierta) FROM eiel_t_cu t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.estado='M' and t.revision_expirada=9999999999) as sup_alibre_m 


FROM 
     eiel_c_nucleo_poblacion n    

WHERE n.codprov='?p' and n.codmunic='?m' 
      --and n.revision_expirada=9999999999
GROUP BY 1,2,3,4,5,6,7
ORDER BY 2,3,4,5,6;
</entry>
<entry key="eiel_indicadores_v_zverde_mun">
INSERT INTO eiel_indicadores_d_zverde(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, codpoblamiento, 
            sup_pn_b, sup_pn_r, sup_pn_m)

SELECT 
        m."GEOMETRY" as "GEOMETRY", m.id as id_municipio, m.nombreoficial
       ,m.id_provincia, m.id_ine,  null as codentidad, null as codpoblamiento



       , ( SELECT SUM(s_solar) FROM eiel_t_pj t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.estado='B' and t.revision_expirada=9999999999) as sup_alibre_b 
       , ( SELECT SUM(s_solar) FROM eiel_t_pj t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.estado='R' and t.revision_expirada=9999999999) as sup_alibre_r
       , ( SELECT SUM(s_solar) FROM eiel_t_pj t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.estado='M' and t.revision_expirada=9999999999) as sup_alibre_m 


FROM 
     municipios m    
WHERE
 ( m.id=?M) and srid(m."GEOMETRY")=4230
GROUP BY 1,2,3,4,5,6,7
ORDER BY 2,3,4,5,6;

</entry>
<entry key="eiel_indicadores_v_zverde_nuc">

INSERT INTO eiel_indicadores_d_zverde(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, codpoblamiento, 
            sup_pn_b, sup_pn_r, sup_pn_m)

SELECT 
        n."GEOMETRY" as "GEOMETRY", (n.codprov || n.codmunic) as id_municipio, n.nombre_oficial
       ,n.codprov, n.codmunic,  n.codentidad, n.codpoblamiento



       , ( SELECT SUM(s_solar) FROM eiel_t_pj t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.estado='B' and t.revision_expirada=9999999999) as sup_pn_b 
       , ( SELECT SUM(s_solar) FROM eiel_t_pj t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.estado='R' and t.revision_expirada=9999999999) as sup_pn_r
       , ( SELECT SUM(s_solar) FROM eiel_t_pj t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.estado='M' and t.revision_expirada=9999999999) as sup_pn_m 


FROM 
     eiel_c_nucleo_poblacion n    

WHERE n.codprov='?p' and n.codmunic='?m' 
      --and n.revision_expirada=9999999999
GROUP BY 1,2,3,4,5,6,7
ORDER BY 2,3,4,5,6;
</entry>

<entry key="eiel_indicadores_vi_csanitario_mun">
INSERT INTO eiel_indicadores_d_csanitario(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, codpoblamiento, 
            nconsultorioslocal, ncentrossalud, ncentrosurg, 
            nhospital, nhospitalgeri, npsiquiatricos, 
            ncamashospital, 
            nnuc_sincsanitario, nhab_sincsanitario, nest_sincsanitario)

SELECT 
        m."GEOMETRY" as "GEOMETRY", m.id as id_municipio, m.nombreoficial
       ,m.id_provincia, m.id_ine,  null as codentidad, null as codpoblamiento

       , ( SELECT COUNT(*) FROM eiel_t_sa t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.tipo IN ('CLO') and t.revision_expirada=9999999999) as nconsultorioslocal 
       , ( SELECT COUNT(*) FROM eiel_t_sa t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.tipo IN ('AMB','CS') and t.revision_expirada=9999999999) as ncentrossalud 
       , ( SELECT COUNT(*) FROM eiel_t_sa t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.tipo IN  ('CUR') and t.revision_expirada=9999999999) as ncentrosurg 

       , ( SELECT COUNT(*) FROM eiel_t_sa t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.tipo IN ('HGL','HIN','HOE','HPS','HQU') and t.revision_expirada=9999999999) as nhospital 
       , ( SELECT COUNT(*) FROM eiel_t_sa t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.tipo IN ('HLE') and t.revision_expirada=9999999999) as nhospitalgeri 
       , null as npsiquiatricos

       , ( SELECT SUM(n_camas) FROM eiel_t_sa t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.tipo IN  ('HGL','HIN','HOE','HPS','HQU') and t.revision_expirada=9999999999) as ncamashospital 
       
       , (SELECT COUNT(*) FROM
			(
			
			select codprov, codmunic, codentidad, codpoblamiento from eiel_c_nucleo_poblacion n 
			EXCEPT 
			select codprov, codmunic, codentidad, codpoblamiento from eiel_t_sa n 

			) as t
	 where  m.id_provincia=t.codprov and m.id_ine=t.codmunic)  as nnuc_sincsanitario
       , null as nhab_sincsanitario
       ,null as nest_sincsanitario

FROM 
     municipios m    
WHERE
 m.id=?M and srid(m."GEOMETRY")=4230
GROUP BY 1,2,3,4,5,6,7
ORDER BY 2,3,4,5,6;

</entry>
<entry key="eiel_indicadores_vi_csanitario_nuc">

INSERT INTO eiel_indicadores_d_csanitario(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, codpoblamiento, 
            nconsultorioslocal, ncentrossalud, ncentrosurg, 
            nhospital, nhospitalgeri, npsiquiatricos, 
            ncamashospital, 
            nnuc_sincsanitario, nhab_sincsanitario, nest_sincsanitario)

SELECT 
        n."GEOMETRY" as "GEOMETRY", (n.codprov || n.codmunic) as id_municipio, n.nombre_oficial
       ,n.codprov, n.codmunic,  n.codentidad, n.codpoblamiento


       , ( SELECT COUNT(*) FROM eiel_t_sa t where   n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.tipo IN ('CLO') and t.revision_expirada=9999999999) as nconsultorioslocal 
       , ( SELECT COUNT(*) FROM eiel_t_sa t where   n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.tipo IN ('AMB','CS') and t.revision_expirada=9999999999) as ncentrossalud 
       , ( SELECT COUNT(*) FROM eiel_t_sa t where   n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.tipo IN  ('CUR') and t.revision_expirada=9999999999) as ncentrosurg 

       , ( SELECT COUNT(*) FROM eiel_t_sa t where   n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.tipo IN ('HGL','HIN','HOE','HPS','HQU') and t.revision_expirada=9999999999) as nhospital 
       , ( SELECT COUNT(*) FROM eiel_t_sa t where   n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.tipo IN ('HLE') and t.revision_expirada=9999999999) as nhospitalgeri 
       , null as npsiquiatricos

       , ( SELECT SUM(n_camas) FROM eiel_t_sa t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.tipo IN  ('HGL','HIN','HOE','HPS','HQU') and t.revision_expirada=9999999999) as ncamashospital 
       
       , null  as nnuc_sincsanitario
       , null as nhab_sincsanitario
       ,null as nest_sincsanitario

FROM 
     eiel_c_nucleo_poblacion n    

WHERE n.codprov='?p' and n.codmunic='?m' 
      --and n.revision_expirada=9999999999
GROUP BY 1,2,3,4,5,6,7
ORDER BY 2,3,4,5,6;
</entry>

<entry key="eiel_indicadores_vi_casistencial_mun">
INSERT INTO eiel_indicadores_d_casistencial(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, 
            codpoblamiento, 
            ncentros, nresidenciasancianos, nplazasresidenciasancianos)

SELECT 
        m."GEOMETRY" as "GEOMETRY", m.id as id_municipio, m.nombreoficial
       ,m.id_provincia, m.id_ine,  null as codentidad, null as codpoblamiento

       , ( SELECT COUNT(*) FROM eiel_t_as t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.revision_expirada=9999999999) as ncentros 
       , ( SELECT COUNT(*) FROM eiel_t_as t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.tipo IN ('RA') and t.revision_expirada=9999999999) as nresidenciasancianos 
       , ( SELECT SUM(plazas) FROM eiel_t_as t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.tipo IN ('RA') and t.revision_expirada=9999999999) as nplazasresidenciasancianos 
FROM 
     municipios m    
WHERE m.id=?M and srid(m."GEOMETRY")=4230
GROUP BY 1,2,3,4,5,6,7
ORDER BY 2,3,4,5,6;

</entry>
<entry key="eiel_indicadores_vi_casistencial_nuc">
INSERT INTO eiel_indicadores_d_casistencial(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, 
            codpoblamiento, 
            ncentros, nresidenciasancianos, nplazasresidenciasancianos)


SELECT 
        n."GEOMETRY" as "GEOMETRY", (n.codprov || n.codmunic) as id_municipio, n.nombre_oficial
       ,n.codprov, n.codmunic,  n.codentidad, n.codpoblamiento



       , ( SELECT COUNT(*) FROM eiel_t_as t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.revision_expirada=9999999999) as ncentros 
       , ( SELECT COUNT(*) FROM eiel_t_as t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.tipo IN ('RA') and t.revision_expirada=9999999999) as nresidenciasancianos 
       , ( SELECT SUM(plazas) FROM eiel_t_as t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.tipo IN ('RA') and t.revision_expirada=9999999999) as nplazasresidenciasancianos 

FROM 
     eiel_c_nucleo_poblacion n    
WHERE n.codprov='?p' and n.codmunic='?m' 
      --and n.revision_expirada=9999999999
GROUP BY 1,2,3,4,5,6,7
ORDER BY 2,3,4,5,6;
</entry>

<entry key="eiel_indicadores_vii_otroserv_mun">
INSERT INTO eiel_indicadores_d_servotros(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, codpoblamiento, 
            nrecintosferiales, nmataderos, 
            ncementarios, ncementerios_saturacionelevada, 
            bomberos_plantilla, bomberos_nvehiculos, 
            pcivil_plantilla, pcivil_nvehiculos, 
            cconsistorial_sup_cubierta_b, cconsistorial_sup_cubierta_r, cconsistorial_sup_cubierta_m)

SELECT 
        m."GEOMETRY" as "GEOMETRY", m.id as id_municipio, m.nombreoficial
       ,m.id_provincia, m.id_ine,  null as codentidad, null as codpoblamiento

       , ( SELECT COUNT(*) FROM eiel_t_lm t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.tipo IN ('FE') and t.revision_expirada=9999999999) as nrecintosferiales 
       , ( SELECT COUNT(*) FROM eiel_t_mt t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic                     and t.revision_expirada=9999999999) as nmataderos 

       , ( SELECT COUNT(*) FROM eiel_t_ce t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic                      and t.revision_expirada=9999999999) as ncementarios 
       , ( SELECT COUNT(*) FROM eiel_t_ce t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.saturacion>90   and t.revision_expirada=9999999999) as ncementerios_saturacionelevada 

       , ( SELECT SUM(plan_profe) FROM eiel_t_ip t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.tipo IN ('BO') and t.revision_expirada=9999999999) as bomberos_plantilla 
       , ( SELECT SUM(vehic_incendio +vehic_rescate +ambulancia+medios_aereos+otros_vehc+quitanieves) FROM eiel_t_ip t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic  and t.tipo IN ('BO') and t.revision_expirada=9999999999) as bomberos_nvehiculos 
              
       , ( SELECT SUM(plan_profe) FROM eiel_t_ip t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic and t.tipo IN ('PC') and t.revision_expirada=9999999999) as pcivil_plantilla 
       , ( SELECT SUM(vehic_incendio +vehic_rescate +ambulancia+medios_aereos+otros_vehc+quitanieves) FROM eiel_t_ip t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic  and t.tipo IN ('PC') and t.revision_expirada=9999999999) as pcivil_nvehiculos 

       , ( SELECT SUM(s_cubierta) FROM eiel_t_cc t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic                and t.estado='B' and t.revision_expirada=9999999999) as cconsistorial_sup_cubierta_b 
       , ( SELECT SUM(s_cubierta) FROM eiel_t_cc t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic                and t.estado='R' and t.revision_expirada=9999999999) as cconsistorial_sup_cubierta_r 
       , ( SELECT SUM(s_cubierta) FROM eiel_t_cc t where  m.id_provincia=t.codprov and m.id_ine=t.codmunic                and t.estado='M' and t.revision_expirada=9999999999) as cconsistorial_sup_cubierta_m 
              

FROM 
     municipios m    
WHERE
 m.id=?M and srid(m."GEOMETRY")=4230
GROUP BY 1,2,3,4,5,6,7
ORDER BY 2,3,4,5,6;

</entry>
<entry key="eiel_indicadores_vii_otroserv_nuc">
INSERT INTO eiel_indicadores_d_servotros(
            "GEOMETRY", id_municipio, toponimo, codprov, codmunic, codentidad, codpoblamiento, 
            nrecintosferiales, nmataderos, 
            ncementarios, ncementerios_saturacionelevada, 
            bomberos_plantilla, bomberos_nvehiculos, 
            pcivil_plantilla, pcivil_nvehiculos, 
            cconsistorial_sup_cubierta_b, cconsistorial_sup_cubierta_r, cconsistorial_sup_cubierta_m)



SELECT 
        n."GEOMETRY" as "GEOMETRY", (n.codprov || n.codmunic) as id_municipio, n.nombre_oficial
       ,n.codprov, n.codmunic,  n.codentidad, n.codpoblamiento

       , ( SELECT COUNT(*) FROM eiel_t_lm t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.tipo IN ('FE') and t.revision_expirada=9999999999) as nrecintosferiales 
       , ( SELECT COUNT(*) FROM eiel_t_mt t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.revision_expirada=9999999999) as nmataderos 

       , ( SELECT COUNT(*) FROM eiel_t_ce t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.revision_expirada=9999999999) as ncementarios 
       , ( SELECT COUNT(*) FROM eiel_t_ce t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.saturacion>90   and t.revision_expirada=9999999999) as ncementerios_saturacionelevada 

       , ( SELECT SUM(plan_profe) FROM eiel_t_ip t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.tipo IN ('BO') and t.revision_expirada=9999999999) as bomberos_plantilla 
       , ( SELECT SUM(vehic_incendio +vehic_rescate +ambulancia+medios_aereos+otros_vehc+quitanieves) FROM eiel_t_ip t where n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento  and t.tipo IN ('BO') and t.revision_expirada=9999999999) as bomberos_nvehiculos 
              
       , ( SELECT SUM(plan_profe) FROM eiel_t_ip t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.tipo IN ('PC') and t.revision_expirada=9999999999) as pcivil_plantilla 
       , ( SELECT SUM(vehic_incendio +vehic_rescate +ambulancia+medios_aereos+otros_vehc+quitanieves) FROM eiel_t_ip t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.tipo IN ('PC') and t.revision_expirada=9999999999) as pcivil_nvehiculos 

       , ( SELECT SUM(s_cubierta) FROM eiel_t_cc t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.estado='B' and t.revision_expirada=9999999999) as cconsistorial_sup_cubierta_b 
       , ( SELECT SUM(s_cubierta) FROM eiel_t_cc t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.estado='R' and t.revision_expirada=9999999999) as cconsistorial_sup_cubierta_r 
       , ( SELECT SUM(s_cubierta) FROM eiel_t_cc t where  n.codprov=t.codprov and n.codmunic=t.codmunic and n.codentidad=t.codentidad and n.codpoblamiento=t.codpoblamiento and t.estado='M' and t.revision_expirada=9999999999) as cconsistorial_sup_cubierta_m 
              

FROM 
     eiel_c_nucleo_poblacion n    

WHERE n.codprov='?p' and n.codmunic='?m' 
      --and n.revision_expirada=9999999999
GROUP BY 1,2,3,4,5,6,7
ORDER BY 2,3,4,5,6;

</entry>


</properties>



