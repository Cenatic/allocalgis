package es.satec.localgismobile.fw.crypto.keystore.imagekeystore.pixelpath;

import java.io.FileWriter;
import java.io.IOException;

import es.satec.localgismobile.fw.image.exceptions.IncorrectImageFormatException;
import es.satec.localgismobile.fw.image.ico.IcoFile;
import es.satec.localgismobile.fw.image.ico.IcoImage;

/**
 * Proporciona un recorrido a través de una imagen generado aleatoriamente
 * (pero siempre el mismo)
 * @author jpolo
 *
 */
public class RandomPixelPath implements IPixelPath {

	public RandomPixelPath(){
		resetPath();
	}
	
	public int getNextPathIndex() {
		int nextPixel = path[currentPos];
		currentPos++;
		return nextPixel;
	}
	
	public int getPathIndex(int index) {
		int pixel = path[index];
		return pixel;
	}	

	public void resetPath() {
		currentPos = 0;		
	}
	
	/**
	 * Genera un recorrido aleatorio sobre los pixeles de una imagen y 
	 * almacena los índices del recorrido en el fichero indicado
	 * @param generatedFilePath Ruta del fichero en el que almacenar el
	 * recorrido generado
	 * @throws IOException Si se produce alguna excepción al leer la imagen
	 * o al escribir el recorrido
	 * @throws IncorrectImageFormatException Si la imagen no se encuentra en
	 * el formato esperado
	 */
	private void generateRandomPath(String generatedFilePath) throws IOException, IncorrectImageFormatException {
		IcoFile myIcon = new IcoFile(generatedFilePath);
		IcoImage icoImage = myIcon.getIcoImage(0);

		int path[] = new int[icoImage.getXorMask().length];

		for (int i = 0; i < path.length; i++) {
			path[i] = i;
		}

		for (int i = 0; i < path.length * 20; i++) {
			int oldIndex = new Long(Math.round((Math.random() * (path.length - 1)))).intValue();
			int newIndex = new Long(Math.round((Math.random() * (path.length - 1)))).intValue();
			int oldIndexValue = path[oldIndex];
			path[oldIndex] = path[newIndex];
			path[newIndex] = oldIndexValue;
		}
		
		FileWriter fileWriter = new FileWriter("c:\\trabajos\\recorrido.txt");
		fileWriter.write("int final path[] = {");
		for (int i = 0; i < path.length-1; i++) {
			fileWriter.write("" + path[i] + ",");
			if (i % 10 == 0)
				fileWriter.write("\n");
		}
		fileWriter.write("" + path[path.length-1] + "};");
		
		fileWriter.close();
	}
	
	int currentPos = 0;

	/**
	 * Array con los índices de los píxels que constituyen
	 * el recorrido sobre la imagen.
	 */
	private final int path[] = {
			9,2110,1785,2324,520,1271,1534,1884,1310,2065,1509,
			1852,1924,2479,784,243,1424,838,303,1470,820,
			2602,2011,1143,644,2754,671,1709,2461,2563,2830,
			1425,938,1266,3046,2709,3034,1189,1144,971,2108,
			1001,1695,804,743,349,690,2375,1904,61,258,
			2928,1778,2423,1611,835,2587,1324,99,1106,2567,
			94,2356,2347,1878,1031,1880,875,2030,2809,914,
			1409,2978,2782,1484,1586,1664,230,961,1295,1237,
			2616,2895,1354,496,2207,1162,2013,1753,2163,2383,
			2881,1039,2145,2691,1946,1597,916,1364,32,1239,
			2490,2051,1374,762,20,2170,537,2406,2297,2196,
			1104,2802,577,1875,2036,1296,419,105,1601,165,
			1906,1960,1078,1359,932,2973,1430,2312,735,2067,
			2990,2408,185,2039,2154,2294,2413,1762,542,2337,
			2487,2730,2458,1649,1981,2710,71,1896,976,451,
			2353,1733,2246,2404,2944,611,2274,2831,626,2933,
			2919,2035,823,2218,845,2696,531,376,1448,2792,
			296,2019,1702,186,1279,3012,274,2025,2510,3064,
			558,2527,1220,2367,1825,2598,1069,1951,669,137,
			149,456,3062,206,2574,2215,1187,670,1944,2960,
			2006,779,2380,348,607,1276,1625,2499,2183,2579,
			2947,2131,1844,2945,911,1411,5,1489,400,420,
			1684,262,1021,1431,2708,2474,725,2012,2341,1536,
			1505,167,1311,1426,1933,2320,526,2855,2884,2277,
			1004,1953,459,2483,1479,423,1522,2266,1699,1134,
			878,2223,1456,343,1060,154,802,2972,2911,2152,
			477,1873,1705,1190,280,2267,2432,1283,2172,3019,
			2189,2054,1603,428,2080,1572,2083,14,1834,2405,
			199,2187,1494,2332,1472,936,560,318,2662,0,
			2429,2894,208,283,655,2105,1920,464,1670,2439,
			2524,2368,98,574,140,1136,2331,18,489,1228,
			1177,2150,2329,1475,795,1588,416,1715,37,182,
			1842,123,2532,2074,119,617,1726,2003,817,2253,
			1209,2348,853,931,2875,1463,1126,3016,1406,135,
			586,2953,753,470,2306,720,2233,2765,1908,1917,
			1277,1076,453,1610,124,620,1763,755,2936,1297,
			2699,2070,1028,3055,2063,1549,1155,2129,2951,1121,
			1570,2198,2964,2572,17,2420,2158,1138,2484,874,
			573,2349,2891,2177,1124,319,1303,1037,1829,954,
			2878,1548,1647,1061,1080,2688,2061,2827,2748,25,
			2382,908,2390,2351,1351,529,2076,2776,1761,253,
			2540,2456,75,686,2769,636,1257,625,1142,2654,
			2836,797,80,1741,608,2603,388,2770,869,1240,
			499,677,3068,1230,2340,913,2740,1452,2752,1903,
			1045,2087,2078,27,2873,1793,1804,437,1676,867,
			1704,2987,1445,941,730,2238,2815,1234,855,2941,
			1486,906,909,389,2900,2358,1184,1821,1084,2773,
			1977,408,1196,2057,1612,1503,2726,1100,1582,1068,
			2599,2609,2593,668,460,2818,493,2376,2536,1950,
			1308,729,766,742,332,547,831,2226,643,1633,
			41,628,1665,2853,777,2126,2794,1767,705,2940,
			988,1929,1661,1193,2611,1035,2768,1363,2653,2910,
			1864,1730,2564,2450,457,1027,3066,1391,486,144,
			1286,746,1631,2561,1179,288,3061,1766,2346,1524,
			2498,2571,883,1673,2983,2717,1206,1952,1716,2342,
			1799,1994,1581,1067,2857,2184,1,95,1915,2261,
			2671,2813,1529,731,129,2313,1434,2001,445,2470,
			2115,2838,2735,375,2660,2440,1922,166,2908,1419,
			860,1731,1617,1744,2113,1030,299,1802,2551,1116,
			1159,697,2416,977,1005,1259,756,2058,2958,813,
			2271,1639,3045,2282,633,2085,1855,133,508,2733,
			361,2546,2229,3021,273,2608,201,2000,73,1803,
			2345,399,1421,2227,1053,1668,1319,1644,1304,1006,
			2412,2692,395,2724,2550,1385,1530,476,979,2017,
			570,1208,614,1135,2325,1389,751,1545,2050,3050,
			1034,16,2059,1316,799,2182,1253,2431,2573,952,
			1640,1890,2663,2330,2639,2631,1539,1674,1713,2526,
			1387,587,786,2863,1972,656,2453,1630,2865,1224,
			1459,279,1513,763,1724,2677,438,2613,2531,1222,
			126,394,898,1819,2893,1262,1433,1739,2117,693,
			2,498,336,2772,264,1651,1148,92,2366,1280,
			3027,344,1990,1114,953,1243,289,2004,528,373,
			2610,2214,2244,1663,458,1511,3000,1353,1800,325,
			1627,1236,964,2162,232,2920,2258,2592,1683,1986,
			1366,2738,2955,503,172,933,2328,1157,1335,1427,
			2775,2623,466,433,658,1043,1811,2544,492,585,
			2073,1160,2686,822,210,1712,1722,2029,956,3041,
			888,2467,447,895,1025,3009,379,513,1003,789,
			1900,525,2434,392,2292,2077,2038,794,744,2491,
			1928,2270,2174,2946,2239,2322,708,1168,1527,1281,
			2173,1813,3048,950,384,320,1816,691,2850,1622,
			1865,842,1608,1591,757,3004,3014,1457,3031,2125,
			2742,801,1493,2949,1432,887,2053,1483,1927,770,
			1519,2300,112,1188,1544,2363,836,984,2971,312,
			1023,713,973,1540,2988,1361,758,1122,665,2278,
			1914,1360,1414,2648,74,1245,2211,2419,442,2275,
			2403,2159,1289,2315,448,623,2698,1872,1930,1125,
			2575,1441,207,252,1531,340,990,805,1167,2514,
			2064,696,2298,765,2791,2286,1734,1547,866,225,
			1504,657,2584,2010,1925,1743,1339,391,2888,141,
			2455,2719,1579,546,1970,1498,549,2181,927,2371,
			3060,1514,2932,58,2577,2774,1194,390,2601,554,
			1325,2123,1377,597,1312,2291,1111,1894,1983,2716,
			1145,800,1658,1346,769,2643,3011,863,2675,1501,
			2082,237,353,3067,864,734,2488,350,739,345,
			615,1796,481,179,454,1233,1919,512,2188,217,
			506,3024,2851,1420,1687,2212,469,43,1285,107,
			76,2191,2948,1065,2694,774,672,2251,1108,2583,
			2764,540,146,2197,659,865,2111,51,266,2428,
			1886,35,1830,1879,1024,924,544,1822,1219,2519,
			879,1870,810,2230,2916,1260,1807,2169,3018,255,
			286,724,703,2515,1137,885,588,999,841,581,
			2859,1439,1095,250,1229,1989,2263,24,2137,439,
			2506,2886,2503,203,1349,629,715,2232,1211,2929,
			2378,2168,1415,1487,1837,2823,3044,1215,745,2114,
			1407,1141,2023,1721,2621,591,2409,562,1980,1210,
			2167,1309,2565,295,2438,2217,1474,2723,1794,2743,
			1634,2441,1217,1666,886,621,854,1140,2533,2103,
			1746,148,2508,371,663,603,2032,2396,297,1306,
			1112,1097,2008,342,992,501,2014,792,846,293,
			850,1238,2915,946,484,1885,2157,641,174,638,
			2667,2303,652,740,1645,2362,118,2041,754,21,
			2877,679,2640,1750,891,1009,1466,2644,2365,894,
			1859,2882,622,220,919,272,2256,1656,223,1305,
			1961,233,1874,2559,1562,1254,2136,1510,1967,2477,
			599,396,551,519,566,1372,2160,2007,1375,2828,
			890,785,1740,1246,2674,406,2848,1284,488,378,
			2447,221,1945,650,1450,1128,231,1578,339,571,
			3017,3059,1251,441,1881,2016,926,2665,2871,1998,
			1367,2880,2442,2867,2179,1451,2974,2480,2959,1091,
			781,1120,2195,775,2892,268,3007,2582,1083,1783,
			2715,1326,764,1654,1265,1923,1481,1696,1476,2352,
			1991,169,3049,2175,2281,198,1386,2706,2695,572,
			2751,676,1533,359,2360,630,1443,136,1974,1164,
			3013,2622,827,2243,1119,589,815,595,7,67,
			518,2581,1038,816,1000,1094,2516,79,2965,426,
			1590,1655,1857,2845,1561,788,1202,490,1079,767,
			13,314,1199,1149,1756,2628,282,1195,1447,2976,
			409,1889,418,939,1382,1307,2090,2026,2615,704,
			899,4,330,2826,1789,559,1585,1344,2224,3054,
			3025,91,2478,2840,2144,57,1791,2817,472,1526,
			635,2529,1541,2589,1805,2283,2721,1941,130,2806,
			2210,776,1328,2220,1008,648,2805,1317,1820,347,
			1910,404,1978,706,596,1258,235,2354,514,1461,
			251,2999,3071,351,87,3008,2240,2028,1437,1607,
			1088,1098,393,2250,2132,1708,2796,1467,1672,2459,
			868,2841,163,1376,64,1543,449,1042,2762,2534,
			1398,1707,1329,2795,287,1244,2104,958,2222,215,
			782,2952,2652,2302,502,1688,3022,934,2629,2402,
			383,2704,692,1905,62,1480,787,101,2128,3070,
			238,1334,60,639,700,2966,100,431,425,688,
			1302,1242,1592,2304,880,1207,1429,2937,1883,2553,
			2635,30,920,227,93,1745,2713,1205,1174,1847,
			2259,1525,660,1958,2452,291,678,1748,807,760,
			1569,178,1689,277,1871,1318,1587,2846,2121,2334,
			2595,70,1018,116,1093,103,921,530,1568,1693,
			1502,3047,2305,33,1460,2842,122,773,1678,3003,
			1853,52,341,2310,1046,1824,2066,307,966,1397,
			627,1602,1096,1849,843,1861,96,2134,1368,1528,
			380,903,36,683,3038,2860,2288,2468,2982,2118,
			2496,3002,1436,2902,957,851,1714,97,1897,2673,
			2068,1729,994,877,837,2033,1150,415,1628,398,
			1314,2449,561,1882,2507,3029,592,651,2206,3036,
			2618,2970,1156,1064,2436,761,204,1642,3057,236,
			2578,1129,923,2124,2247,461,2905,187,2780,313,
			323,2500,2701,2022,791,1932,2981,1964,1181,1048,
			1337,1350,1860,583,1848,2394,2437,509,1777,806,
			1868,1063,1033,2280,1584,2821,2037,346,1485,2588,
			2293,2225,516,1340,1062,2119,1537,2387,580,212,
			1075,602,1482,1449,2741,1856,337,424,1197,983,
			1728,2819,828,1749,2570,2034,363,1770,2591,902,
			1784,125,2814,575,594,2481,2056,2994,2887,929,
			1320,2787,1052,2669,871,951,982,2783,1405,727,
			1782,661,2800,2977,565,1841,1082,2810,2861,1020,
			2942,722,523,2562,917,2918,2957,1226,2512,2975,
			1200,290,1029,1275,1948,2299,2473,2797,2986,654,
			2907,1401,1735,2874,2511,2497,2272,2106,2690,222,
			3020,1153,1760,733,1291,1298,2002,2418,1598,2998,
			1984,145,859,598,2249,2323,2316,2319,2133,2538,
			2789,2273,81,2600,2777,738,1090,3028,468,2679,
			1576,699,1580,500,2980,900,2590,2858,991,702,
			2262,1355,532,1081,322,2448,2513,814,2464,356,
			1954,1620,1139,304,3001,1832,157,1963,1657,2672,
			1300,1888,876,2410,2816,127,386,214,2398,1015,
			790,2605,1086,1051,1565,2203,2343,1947,2399,2385,
			1679,2968,1677,2718,1506,2637,1198,239,689,1792,
			2566,1577,2785,2749,26,446,609,2116,2462,3015,
			1629,334,937,440,861,1759,2178,1754,1399,1641,
			2625,443,962,1596,945,619,77,959,1736,1428,
			2045,46,970,1589,1551,1383,410,2422,2904,1787,
			1066,2995,701,1261,321,1131,2634,2264,434,479,
			2333,1232,2767,584,2807,1182,497,1605,2702,3032,
			647,2620,1508,1490,2545,896,267,1077,847,1997,
			2518,2140,3043,2084,2112,2268,39,2568,2897,1267,
			1593,422,2549,2130,567,194,1270,1315,798,2812,
			1458,1227,1287,3030,1146,2788,1152,1638,1567,685,
			1056,480,2209,1966,935,2386,637,1049,771,2252,
			1518,975,1418,2554,139,1694,1412,2755,2093,306,
			892,2109,2255,507,2301,2018,1087,527,482,2872,
			2711,224,943,1352,1814,1118,2228,2761,1523,1801,
			2596,2338,2372,881,2336,1956,2739,2687,1301,553,
			427,642,2285,83,2219,2689,2296,1390,2537,2213,
			1299,1274,1555,1619,2645,2656,2407,682,397,778,
			162,1453,1288,6,2746,2606,1866,535,1241,1571,
			1173,211,1442,631,601,1294,2876,1469,1851,2693,
			2869,844,494,1786,1047,2192,2820,1176,372,3040,
			803,3039,1742,2736,2839,2779,435,1413,115,2685,
			1507,2834,1103,1127,1719,1330,1717,2216,2311,780,
			2835,471,996,2472,2096,65,259,2015,2633,2681,
			1836,1322,284,2415,717,1987,202,2190,2837,2750,
			1720,2542,173,2670,2825,1113,2624,1931,2753,1394,
			1381,2758,1073,2269,548,1698,1348,1147,848,2392,
			1662,34,541,429,2903,1757,2194,2241,2314,354,
			1968,45,2659,534,364,49,824,161,2658,2446,
			263,839,2642,183,2985,1478,1646,29,2097,997,
			1016,1992,681,1357,1500,2541,1499,2142,600,1681,
			1400,2917,2414,2161,147,2469,1408,578,750,2049,
			821,2747,2824,1975,260,2555,1105,606,1115,1252,
			1332,2425,358,261,1002,2279,940,1768,1059,955,
			1618,1342,2046,2714,856,2798,242,1203,1971,2284,
			1558,2149,2793,2141,752,2604,1268,8,338,1595,
			687,1163,2381,495,1101,910,897,1347,411,522,
			44,667,1050,2350,405,1771,2327,1515,533,987,
			2079,2204,1863,1180,2991,2099,1378,1231,2890,1249,
			365,1109,407,138,2495,840,1373,613,965,2153,
			1272,2926,1532,275,1553,716,56,2801,2339,2896,
			197,1876,104,2055,3037,292,2522,749,1557,1575,
			2661,1838,664,1092,1916,1435,2445,1700,1942,2912,
			3063,2089,462,1192,1256,1937,1781,1343,2655,2265,
			2771,2781,1940,1468,1976,3069,1455,1637,1201,905,
			539,121,256,229,402,2062,1604,1845,2148,2193,
			357,2833,403,1690,2935,2200,2202,747,1204,385,
			1417,1850,1191,200,1732,467,2318,1186,714,1552,
			2614,1898,1949,2180,2612,723,308,2492,1775,2389,
			1365,3042,2186,710,1247,1538,2766,1264,2745,1017,
			2700,649,2626,2630,491,2317,228,1007,1812,2856,
			1396,1583,1358,88,171,1013,1564,1934,930,849,
			1643,2355,85,329,2047,960,2832,2632,915,1273,
			2521,2829,1939,401,1957,276,985,963,1918,1788,
			1416,1362,1132,1773,2426,1635,42,301,1943,1497,
			50,1169,66,1962,271,192,63,12,1843,19,
			2176,305,1488,736,593,2156,2451,2486,1559,2697,
			2309,1213,2997,1667,517,564,1290,1341,2166,1055,
			478,2523,2075,188,2466,317,1828,1955,2539,1725,
			737,54,155,1026,928,2504,1862,1823,2444,825,
			2922,1680,111,2254,1444,417,1393,2471,1621,543,
			2811,2024,1988,1774,2361,298,646,944,2680,158,
			811,143,59,949,1827,2502,1973,159,1102,78,
			2373,2993,2914,2961,413,2939,368,1692,2295,216,
			2071,2885,2234,2594,796,2969,1703,2784,430,181,
			86,2676,1912,1854,590,978,2092,1293,2732,463,
			515,604,718,2242,2585,1985,2384,1895,2107,524,
			1175,610,2208,2027,1779,1166,634,326,1218,1011,
			265,550,653,726,1130,793,511,2401,11,2627,
			2040,2069,694,2245,2657,1133,1471,2276,2556,579,
			196,1710,1154,1909,436,160,1491,2248,300,366,
			2641,1648,151,1755,826,450,1691,1623,209,829,
			2400,68,1171,2786,152,2744,1594,1650,190,2552,
			2164,1554,666,545,2127,1697,995,2122,1669,2756,
			382,2417,2475,2465,153,302,1356,2803,128,1574,
			15,1074,473,2289,90,510,1370,3056,640,707,
			882,2395,82,2927,1652,673,109,1901,1071,1911,
			2580,370,907,1614,245,521,176,1185,1040,2411,
			2031,248,38,120,2759,452,2505,645,922,624,
			2135,2476,1764,1214,2236,969,1380,2525,1636,2042,
			2290,967,1959,552,1907,2357,741,1521,2647,10,
			360,980,1747,2808,904,106,2722,2868,972,3,
			2485,1172,2790,1123,1902,2388,2950,1041,1110,2727,
			2143,1542,102,2737,3051,2729,2619,69,912,1384,
			2646,2489,2260,1833,2335,1170,1600,2520,1446,2925,
			2543,2009,475,2020,2682,1599,270,1099,2308,2457,
			538,2146,333,377,2098,695,1036,3005,2397,986,
			170,309,942,1891,1609,1379,3058,1965,2607,2548,
			504,2547,2924,1517,3023,23,873,1178,1282,2094,
			1032,2391,189,191,1615,1758,2101,2849,164,247,
			1711,184,177,2427,55,555,2557,2231,2984,1107,
			830,1969,1117,244,2287,1464,857,2102,1070,1999,
			1345,2048,2725,2879,254,1225,352,1751,2852,1263,
			257,1921,2683,2530,1556,1653,1798,387,3006,474,
			1606,1248,455,998,2763,2909,2989,1926,1223,310,
			632,2517,901,3010,193,1818,1044,249,719,783,
			2938,2430,1996,947,1624,1410,1321,2889,1183,2235,
			2139,1626,1085,1817,246,328,134,2901,465,1331,
			569,1520,278,1278,1772,2804,487,2421,1780,2931,
			1877,1936,241,1718,2326,1019,1573,1738,974,675,
			2393,2712,1422,1323,285,150,618,1492,1660,485,
			1982,1151,219,832,2155,2664,2651,2906,2379,711,
			1221,2799,812,2493,2307,1057,269,1701,2171,2862,
			2934,2460,1892,1938,852,1815,2237,809,1867,1566,
			72,2921,1727,1913,1440,1473,53,2930,2854,1993,
			2147,3052,1671,1776,2344,1835,1752,2864,1495,2021,
			1014,2963,2364,2866,2650,2558,2967,568,1839,156,
			3026,180,2992,1887,113,833,2095,2576,1616,674,
			1158,1010,1685,1336,1477,114,662,31,808,2081,
			2091,2205,335,1563,2482,2043,234,918,818,2844,
			2731,1723,582,1250,168,1682,712,444,362,2052,
			311,1546,862,612,2185,1327,2668,2569,536,414,
			2501,226,1686,1333,968,1560,3053,2913,2870,1058,
			2201,132,2370,925,2617,2060,948,412,381,1826,
			748,483,47,1765,884,2720,2005,2494,1012,2443,
			421,327,2221,728,374,131,2979,1831,1675,281,
			819,981,2996,858,331,1806,315,355,2597,2321,
			2072,989,175,1292,2151,870,1979,1402,684,2359,
			1797,1089,2535,40,2463,557,3035,240,772,1893,
			709,2678,2369,2199,2705,1769,3033,563,1371,1613,
			2088,2638,1438,2923,2454,1496,2374,28,2898,2757,
			1737,1161,893,2684,1465,576,1395,108,1808,369,
			1404,213,1869,1216,1550,1516,1935,1269,2433,1995,
			556,2086,1858,2734,1454,1369,732,2509,2100,2586,
			2138,993,205,2962,616,117,1392,680,2649,1535,
			2843,1255,605,2528,505,1072,2666,2847,316,2883,
			1840,48,2728,1022,1846,2424,2822,889,2778,1659,
			1809,2636,2257,2044,2120,2435,1462,1165,3065,1235,
			218,1054,294,84,721,324,2943,142,1790,1313,
			1212,432,1512,2954,759,1403,1388,2956,2703,110,
			698,834,1338,1810,2760,768,1706,2707,1632,2899,
			2165,872,2560,2377,1795,1899,367,89,195,1423,22};

}
